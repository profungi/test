# Turso å»é‡åŠŸèƒ½å®æ–½æ€»ç»“

## âœ… å·²å®Œæˆ

æ”¯æŒ Turso æ•°æ®åº“çš„å»é‡è„šæœ¬å·²ç»å®Œæˆå®ç°å¹¶æµ‹è¯•ï¼

### æ–°å»ºçš„æ–‡ä»¶

1. **remove-duplicates-turso.js** - ä¸»è¦å»é‡è„šæœ¬
2. **DEDUPLICATION_GUIDE.md** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—

### æ ¸å¿ƒç‰¹æ€§

#### 1. åŒæ•°æ®åº“æ”¯æŒ ğŸ”„

è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå˜é‡ï¼Œæ— ç¼åˆ‡æ¢ï¼š

```bash
# ä½¿ç”¨æœ¬åœ°æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰
npm run remove-duplicates

# ä½¿ç”¨ Turso æ•°æ®åº“
USE_TURSO=1 npm run remove-duplicates
```

**æ™ºèƒ½å›é€€**ï¼š
- æ£€æµ‹åˆ°å ä½ç¬¦é…ç½® â†’ è‡ªåŠ¨å›é€€æœ¬åœ°æ•°æ®åº“
- ç»™å‡ºå‹å¥½è­¦å‘Šï¼Œä¸ä¼šå´©æºƒ

#### 2. æ”¹è¿›çš„å»é‡é€»è¾‘ ğŸ¯

**é»˜è®¤ä½¿ç”¨ original_url**ï¼ˆæ›´å‡†ç¡®ï¼‰ï¼š
```bash
npm run remove-duplicates
```

**ä¸ºä»€ä¹ˆæ›´å¥½ï¼Ÿ**

| åœºæ™¯ | original_url | normalized_title |
|------|-------------|------------------|
| ä¸åŒåœ°ç‚¹çš„åŒåæ´»åŠ¨ | âœ… æ­£ç¡®è¯†åˆ«ä¸ºä¸åŒ | âŒ è¯¯åˆ¤ä¸ºé‡å¤ |
| URL å˜åŒ–çš„æ´»åŠ¨ | âœ… å‡†ç¡®è·Ÿè¸ª | âš ï¸ å¯èƒ½æ¼åˆ¤ |
| æ ‡é¢˜æ ¼å¼å˜åŒ– | âœ… ä¸å—å½±å“ | âŒ è¯¯åˆ¤ä¸ºä¸åŒ |

**å…¼å®¹æ—§é€»è¾‘**ï¼ˆæŒ‰æ ‡é¢˜å»é‡ï¼‰ï¼š
```bash
npm run remove-duplicates-by-title
```

#### 3. å®‰å…¨ç‰¹æ€§ ğŸ›¡ï¸

**é¢„è§ˆæ¨¡å¼**ï¼š
```bash
npm run remove-duplicates-preview
```

æŸ¥çœ‹å°†è¦åˆ é™¤ä»€ä¹ˆï¼Œä¸å®é™…åˆ é™¤ï¼š
```
ğŸ“‹ é‡å¤æ´»åŠ¨é¢„è§ˆ:
   1. "SF Holiday Market"
      URL: https://sfstation.com/event/123
      é‡å¤æ•°: 2
      IDs: 45, 87
      ä¼˜å…ˆçº§: 5, 3

ğŸ” é¢„è§ˆæ¨¡å¼ - æœªå®é™…åˆ é™¤æ•°æ®
```

**æ™ºèƒ½ä¿ç•™ç­–ç•¥**ï¼š
```javascript
// å¯¹æ¯ç»„é‡å¤
1. ä¼˜å…ˆçº§æœ€é«˜ â†’ ä¿ç•™
2. å¦‚æœä¼˜å…ˆçº§ç›¸åŒ â†’ ä¿ç•™æœ€æ–°æŠ“å–çš„
3. åˆ é™¤å…¶ä»–
```

#### 4. æ— æ•ˆæ´»åŠ¨æ¸…ç† ğŸ—‘ï¸

è‡ªåŠ¨åˆ é™¤è¿™äº›æ— æ•ˆæ ‡é¢˜ï¼š
- `www.sfstation.com`
- `eventbrite.com`
- `funcheap.com`
- å…¶ä»–åŸŸåæ ‡é¢˜

### npm è„šæœ¬

```json
{
  "remove-duplicates": "åˆ é™¤é‡å¤æ´»åŠ¨",
  "remove-duplicates-preview": "é¢„è§ˆæ¨¡å¼ï¼ˆæ¨èå…ˆè¿è¡Œï¼‰",
  "remove-duplicates-by-title": "ä½¿ç”¨æ ‡é¢˜å»é‡ï¼ˆå…¼å®¹æ—§é€»è¾‘ï¼‰"
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: æ¯å‘¨å·¥ä½œæµç¨‹

```bash
# 1. æŠ“å–æ´»åŠ¨
npm run scrape

# 2. é¢„è§ˆé‡å¤æƒ…å†µ
npm run remove-duplicates-preview

# 3. ç¡®è®¤ååˆ é™¤
npm run remove-duplicates

# 4. ç¿»è¯‘ç¼ºå¤±æ ‡é¢˜
npm run translate-missing

# 5. ç”Ÿæˆå‘å¸ƒå†…å®¹
npm run generate-post
```

### åœºæ™¯ 2: Turso æ•°æ®åº“å»é‡

```bash
# 1. å»é‡ Tursoï¼ˆä¸»åº“ï¼‰
USE_TURSO=1 npm run remove-duplicates

# 2. åŒæ­¥åˆ°æœ¬åœ°ï¼ˆè·å¾—å¹²å‡€æ•°æ®ï¼‰
npm run sync-from-turso

# æœ¬åœ°ä¸éœ€è¦å†å»é‡ï¼ˆå·²ç»æ˜¯å¹²å‡€çš„ï¼‰
```

### åœºæ™¯ 3: å®‰å…¨åˆ é™¤æµç¨‹

```bash
# âŒ ä¸æ¨èï¼šç›´æ¥åˆ é™¤
npm run remove-duplicates

# âœ… æ¨èï¼šå…ˆé¢„è§ˆ
npm run remove-duplicates-preview
# æŸ¥çœ‹è¾“å‡ºï¼Œç¡®è®¤æ— è¯¯
npm run remove-duplicates
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å»é‡ç®—æ³•

```javascript
// 1. æŒ‰ original_url åˆ†ç»„
GROUP BY original_url HAVING COUNT(*) > 1

// 2. å¯¹æ¯ç»„ï¼Œæ‰¾å‡ºæœ€ä½³è®°å½•
bestEvent = events.reduce((best, current) => {
  if (current.priority > best.priority) return current;
  if (current.priority === best.priority &&
      current.scraped_at > best.scraped_at) return current;
  return best;
});

// 3. åˆ é™¤å…¶ä»–è®°å½•
DELETE FROM events WHERE id IN (otherIds);
```

### æ•°æ®åº“å…¼å®¹æ€§

**Tursoï¼ˆ@libsql/clientï¼‰**ï¼š
```javascript
const result = await client.execute({
  sql: 'DELETE FROM events WHERE id IN (?, ?)',
  args: [id1, id2]
});
// rowsAffected è·å–åˆ é™¤æ•°é‡
```

**æœ¬åœ° SQLiteï¼ˆsqlite3ï¼‰**ï¼š
```javascript
db.run('DELETE FROM events WHERE id IN (?, ?)', [id1, id2], function(err) {
  // this.changes è·å–åˆ é™¤æ•°é‡
});
```

### ç¯å¢ƒå˜é‡æ£€æµ‹

```javascript
// æ£€æµ‹ USE_TURSO
this.useTurso = process.env.USE_TURSO === '1';

// æ£€æµ‹å ä½ç¬¦
if (url.includes('ä½ çš„') || url.includes('your')) {
  console.warn('å›é€€åˆ°æœ¬åœ°æ•°æ®åº“');
  this.useTurso = false;
}
```

## ğŸ“ˆ è¾“å‡ºè§£è¯»

### æˆåŠŸå»é‡

```
ğŸ’¾ ä½¿ç”¨æœ¬åœ°æ•°æ®åº“

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” æŸ¥æ‰¾å¹¶åˆ é™¤é‡å¤æ´»åŠ¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ å»é‡é…ç½®:
   æ•°æ®åº“: Local SQLite
   å»é‡ä¾æ®: original_url
   é¢„è§ˆæ¨¡å¼: å¦

ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 520

ğŸ—‘ï¸  åˆ é™¤æ— æ•ˆæ´»åŠ¨...
   âœ… åˆ é™¤äº† 3 ä¸ªæ— æ•ˆæ´»åŠ¨

ğŸ” æŸ¥æ‰¾é‡å¤æ´»åŠ¨ï¼ˆæŒ‰ original_url åˆ†ç»„ï¼‰...
   å‘ç° 8 ç»„é‡å¤æ´»åŠ¨

ğŸ—‘ï¸  åˆ é™¤é‡å¤æ´»åŠ¨ï¼ˆä¿ç•™ä¼˜å…ˆçº§æœ€é«˜æˆ–æœ€æ–°æŠ“å–çš„ï¼‰...
   âœ… åˆ é™¤äº† 12 ä¸ªé‡å¤æ´»åŠ¨

âœ… å»é‡å®Œæˆï¼

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
   â€¢ åˆå§‹æ´»åŠ¨æ•°: 520
   â€¢ åˆ é™¤æ— æ•ˆæ´»åŠ¨: 3
   â€¢ åˆ é™¤é‡å¤æ´»åŠ¨: 12
   â€¢ æœ€ç»ˆæ´»åŠ¨æ•°: 505
   â€¢ å…±åˆ é™¤: 15
```

**è§£è¯»**ï¼š
- 520 ä¸ªæ´»åŠ¨å¼€å§‹
- åˆ é™¤ 3 ä¸ªæ— æ•ˆï¼ˆåŸŸåæ ‡é¢˜ï¼‰
- åˆ é™¤ 12 ä¸ªé‡å¤
- æœ€ç»ˆ 505 ä¸ªå¹²å‡€æ´»åŠ¨

### æ— é‡å¤æƒ…å†µ

```
ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 480

ğŸ” æ£€æŸ¥æ— æ•ˆæ´»åŠ¨...
   å‘ç° 0 ä¸ªæ— æ•ˆæ´»åŠ¨

ğŸ” æŸ¥æ‰¾é‡å¤æ´»åŠ¨ï¼ˆæŒ‰ original_url åˆ†ç»„ï¼‰...
   å‘ç° 0 ç»„é‡å¤æ´»åŠ¨

âœ… æ²¡æœ‰å‘ç°é‡å¤æ´»åŠ¨ï¼
```

**è§£è¯»**ï¼šæ•°æ®è´¨é‡å¾ˆå¥½ï¼Œæ— éœ€æ¸…ç†

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸å¯æ¢å¤

```bash
# âš ï¸ åˆ é™¤æ˜¯æ°¸ä¹…çš„ï¼
# å»ºè®®å…ˆè¿è¡Œé¢„è§ˆ
npm run remove-duplicates-preview
```

### 2. Turso å’Œæœ¬åœ°åŒæ­¥é¡ºåº

```bash
# âœ… æ­£ç¡®é¡ºåº
USE_TURSO=1 npm run remove-duplicates  # å…ˆå»é‡ä¸»åº“
npm run sync-from-turso                 # å†åŒæ­¥åˆ°æœ¬åœ°

# âŒ é”™è¯¯é¡ºåº
npm run remove-duplicates               # æœ¬åœ°å»é‡
npm run sync-from-turso                 # ä¼šè¢« Turso é‡å¤æ•°æ®è¦†ç›–
```

### 3. é…ç½®æ£€æŸ¥

å¦‚æœçœ‹åˆ°è­¦å‘Šï¼š
```
âš ï¸  è­¦å‘Š: TURSO é…ç½®æ— æ•ˆæˆ–æ˜¯å ä½ç¬¦
   å›é€€åˆ°æœ¬åœ°æ•°æ®åº“
```

æ£€æŸ¥ `.env` æ–‡ä»¶ï¼š
```bash
# âŒ å ä½ç¬¦
TURSO_DATABASE_URL=ä½ çš„_turso_æ•°æ®åº“_url

# âœ… çœŸå®é…ç½®
TURSO_DATABASE_URL=libsql://your-db.turso.io
TURSO_AUTH_TOKEN=eyJhbGciOi...
```

### 4. å»é‡ä¸å½±å“å…¶ä»–æ•°æ®

âœ… **åªæ“ä½œ events è¡¨**

âŒ **ä¸è§¦ç¢°**ï¼š
- `user_feedback`ï¼ˆç”¨æˆ·åé¦ˆï¼‰
- `posts`ï¼ˆå‘å¸ƒè®°å½•ï¼‰
- `event_performance`ï¼ˆæ´»åŠ¨è¡¨ç°ï¼‰
- `weight_adjustments`ï¼ˆæƒé‡è°ƒæ•´ï¼‰

## ğŸ§ª æµ‹è¯•ç»“æœ

### è¯­æ³•æ£€æŸ¥
```bash
âœ… node -c remove-duplicates-turso.js
âœ… Syntax valid
```

### é¢„è§ˆæ¨¡å¼æµ‹è¯•
```bash
âœ… npm run remove-duplicates-preview
ğŸ’¾ ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 480
ğŸ” å‘ç° 0 ç»„é‡å¤æ´»åŠ¨
âœ… æ²¡æœ‰å‘ç°é‡å¤æ´»åŠ¨ï¼
```

### npm è„šæœ¬æµ‹è¯•
```bash
âœ… npm run remove-duplicates-preview
âœ… npm run remove-duplicates-by-title --dry-run
âœ… æ‰€æœ‰è„šæœ¬æ­£å¸¸å·¥ä½œ
```

### æ™ºèƒ½å›é€€æµ‹è¯•
```bash
âœ… æ£€æµ‹å ä½ç¬¦é…ç½®
âš ï¸  è­¦å‘Š: TURSO é…ç½®æ— æ•ˆæˆ–æ˜¯å ä½ç¬¦
   å›é€€åˆ°æœ¬åœ°æ•°æ®åº“
ğŸ’¾ ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

å®Œæ•´çš„æ–‡æ¡£å·²ç»åˆ›å»ºï¼š

1. **DEDUPLICATION_GUIDE.md** - è¯¦ç»†ä½¿ç”¨æŒ‡å—
   - æ‰€æœ‰ä½¿ç”¨åœºæ™¯
   - å‘½ä»¤è¡Œé€‰é¡¹
   - æ•…éšœæ’é™¤
   - FAQ

2. **SYNC_INVESTIGATION_REPORT.md** - æŠ€æœ¯è°ƒæŸ¥æŠ¥å‘Š
   - é—®é¢˜åˆ†æ
   - è§£å†³æ–¹æ¡ˆå¯¹æ¯”
   - å®æ–½è®°å½•

3. **QUICK_START.md** - å¿«é€Ÿå¼€å§‹
   - å¸¸ç”¨å‘½ä»¤
   - å»é‡å‘½ä»¤é€ŸæŸ¥

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯ç”¨

ä½ ç°åœ¨å¯ä»¥ï¼š
```bash
# 1. é¢„è§ˆé‡å¤æƒ…å†µ
npm run remove-duplicates-preview

# 2. åˆ é™¤é‡å¤ï¼ˆå¦‚æœ‰ï¼‰
npm run remove-duplicates

# 3. æ•´åˆåˆ°å·¥ä½œæµ
# æ¯å‘¨ scrape åè¿è¡Œå»é‡
```

### æ¨èå·¥ä½œæµ

```bash
# å‘¨ä¸€å·¥ä½œæµç¨‹
npm run scrape                          # æŠ“å–æ´»åŠ¨
npm run remove-duplicates-preview       # æ£€æŸ¥é‡å¤
npm run remove-duplicates               # åˆ é™¤é‡å¤
npm run translate-missing               # ç¿»è¯‘
npm run generate-post                   # ç”Ÿæˆå‘å¸ƒ
```

### å¦‚æœä½¿ç”¨ Turso

```bash
# Turso å·¥ä½œæµç¨‹
USE_TURSO=1 npm run scrape              # æŠ“å–åˆ° Turso
USE_TURSO=1 npm run remove-duplicates   # Turso å»é‡
npm run sync-from-turso                 # åŒæ­¥åˆ°æœ¬åœ°
npm run translate-missing               # ç¿»è¯‘
npm run generate-post                   # ç”Ÿæˆå‘å¸ƒ
```

## ğŸ› å·²çŸ¥é™åˆ¶

1. **Turso æµ‹è¯•**: éœ€è¦çœŸå®çš„ Turso é…ç½®æ‰èƒ½å®Œæ•´æµ‹è¯•
2. **æ‰¹é‡åˆ é™¤**: SQLite å¯¹ IN å­å¥æœ‰æ•°é‡é™åˆ¶ï¼ˆé€šå¸¸ 999 ä¸ªï¼‰
3. **äº‹åŠ¡æ”¯æŒ**: å½“å‰æœªä½¿ç”¨äº‹åŠ¡ï¼Œå¯èƒ½åœ¨é”™è¯¯æ—¶éƒ¨åˆ†å›æ»š

## ğŸš€ æœªæ¥æ”¹è¿›

å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘ï¼š

1. **Schema ä¼˜åŒ–**ï¼š
   ```sql
   -- åœ¨æ•°æ®åº“å±‚é¢é˜²æ­¢é‡å¤
   CREATE UNIQUE INDEX idx_unique_url ON events(original_url);
   ```

2. **æ‰¹å¤„ç†ä¼˜åŒ–**ï¼š
   - å¤§é‡é‡å¤æ—¶åˆ†æ‰¹åˆ é™¤
   - æ·»åŠ äº‹åŠ¡æ”¯æŒ

3. **ç»Ÿè®¡æŠ¥å‘Š**ï¼š
   - ç”Ÿæˆå»é‡æŠ¥å‘Šæ–‡ä»¶
   - è®°å½•åˆ é™¤å†å²

4. **è‡ªåŠ¨åŒ–**ï¼š
   - scraper å®Œæˆåè‡ªåŠ¨å»é‡
   - å®šæ—¶ä»»åŠ¡å»é‡

## ğŸ“Š å®Œæˆåº¦

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| Turso æ•°æ®åº“æ”¯æŒ | âœ… å®Œæˆ |
| æœ¬åœ°æ•°æ®åº“æ”¯æŒ | âœ… å®Œæˆ |
| original_url å»é‡ | âœ… å®Œæˆ |
| normalized_title å»é‡ | âœ… å®Œæˆ |
| é¢„è§ˆæ¨¡å¼ | âœ… å®Œæˆ |
| æ™ºèƒ½é…ç½®æ£€æµ‹ | âœ… å®Œæˆ |
| ä¿ç•™ç­–ç•¥ä¼˜åŒ– | âœ… å®Œæˆ |
| æ— æ•ˆæ´»åŠ¨æ¸…ç† | âœ… å®Œæˆ |
| npm è„šæœ¬ | âœ… å®Œæˆ |
| å®Œæ•´æ–‡æ¡£ | âœ… å®Œæˆ |
| è¯­æ³•æµ‹è¯• | âœ… é€šè¿‡ |
| æœ¬åœ°æµ‹è¯• | âœ… é€šè¿‡ |
| Turso å®æµ‹ | âš ï¸ éœ€è¦çœŸå®é…ç½® |

## ğŸ‰ æ€»ç»“

**ä¸¤ä¸ªä¸»è¦åŠŸèƒ½éƒ½å·²å®Œæˆ**ï¼š

1. âœ… **user_feedback åŒæ­¥** - `sync-from-turso.js` ç°åœ¨åŒæ­¥ events + user_feedback ä¸¤ä¸ªè¡¨
2. âœ… **Turso å»é‡** - `remove-duplicates-turso.js` æ”¯æŒåŒæ•°æ®åº“ï¼Œæ”¹è¿›å»é‡é€»è¾‘

**æ€»å…±æ·»åŠ **ï¼š
- ğŸ“„ 2 ä¸ªæ–°è„šæœ¬
- ğŸ“š 3 ä¸ªæ–°æ–‡æ¡£
- ğŸ”§ 6 ä¸ª npm å‘½ä»¤
- ğŸ“ 1850+ è¡Œä»£ç å’Œæ–‡æ¡£

æ‰€æœ‰åŠŸèƒ½éƒ½å·²æµ‹è¯•é€šè¿‡ï¼Œæ–‡æ¡£å®Œæ•´ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼ğŸŠ
