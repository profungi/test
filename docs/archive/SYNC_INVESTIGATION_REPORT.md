# åŒæ­¥åŠŸèƒ½é—®é¢˜è°ƒæŸ¥æŠ¥å‘Š

## è°ƒæŸ¥æ—¶é—´
2025-12-10

## é—®é¢˜æè¿°
ç”¨æˆ·æŠ¥å‘Šäº†ä¸¤ä¸ªåŒæ­¥ç›¸å…³çš„é—®é¢˜éœ€è¦è°ƒæŸ¥ï¼š

1. **user_feedback è¡¨åŒæ­¥é—®é¢˜**ï¼šç½‘ç«™çš„ç‚¹èµž/åé¦ˆæ•°æ®å†™å…¥ Turso æ•°æ®åº“ï¼Œä½†æ²¡æœ‰åŒæ­¥åˆ°æœ¬åœ°
2. **remove-duplicates.js è„šæœ¬é—®é¢˜**ï¼šè„šæœ¬ä¼¼ä¹Žä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œè€Œä¸”æ²¡æœ‰é’ˆå¯¹ Turso æ•°æ®åº“åŽ»é‡

---

## é—®é¢˜ 1: user_feedback è¡¨åŒæ­¥

### çŽ°çŠ¶åˆ†æž

#### æ•°æ®æµå‘
```
Website (Next.js)
  â†“
  å†™å…¥ Turso: user_feedback è¡¨
  â†“
  âŒ æ²¡æœ‰åŒæ­¥åˆ°æœ¬åœ°
```

#### è¡¨ç»“æž„
**Turso å’Œæœ¬åœ°æ•°æ®åº“éƒ½æœ‰ user_feedback è¡¨**ï¼Œç»“æž„å®Œå…¨ä¸€è‡´ï¼š

```sql
CREATE TABLE user_feedback (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT NOT NULL,         -- ç”¨æˆ·ä¼šè¯IDï¼ˆåŒ¿åï¼‰
  feedback_type TEXT NOT NULL,      -- 'thumbs_up' æˆ– 'thumbs_down'
  comment TEXT,                     -- ç”¨æˆ·è¯„è®º
  filter_state TEXT,                -- è¿‡æ»¤å™¨çŠ¶æ€ï¼ˆJSONï¼‰
  events_shown INTEGER,             -- æ˜¾ç¤ºçš„æ´»åŠ¨æ•°é‡
  user_agent TEXT,                  -- æµè§ˆå™¨ä¿¡æ¯
  referrer TEXT,                    -- æ¥æºé¡µé¢
  locale TEXT,                      -- è¯­è¨€ï¼ˆen/zhï¼‰
  created_at TEXT NOT NULL,         -- åˆ›å»ºæ—¶é—´
  ip_hash TEXT                      -- IPå“ˆå¸Œï¼ˆéšç§ä¿æŠ¤ï¼‰
);
```

**ç´¢å¼•**ï¼š
- `idx_feedback_type` on `feedback_type`
- `idx_feedback_created` on `created_at DESC`
- `idx_feedback_session` on `session_id`

#### å½“å‰å®žçŽ°

**Website å†™å…¥**ï¼ˆ`website/app/api/feedback/route.ts:44-56`ï¼‰ï¼š
```typescript
// ç›´æŽ¥å†™å…¥ Turso
const result = await saveFeedback({
  sessionId,
  feedbackType,
  comment,
  filterState: filterState ? JSON.stringify(filterState) : undefined,
  eventsShown,
  userAgent,
  referrer,
  locale: locale || 'en',
  ipHash,
});
```

**sync-from-turso.js å½“å‰åªåŒæ­¥**ï¼š
- âœ… `events` è¡¨
- âŒ **ä¸åŒæ­¥** `user_feedback` è¡¨

### é—®é¢˜æ ¹æº

`sync-from-turso.js` è®¾è®¡æ—¶åªè€ƒè™‘äº†å•å‘åŒæ­¥ `events` è¡¨ï¼ˆæ´»åŠ¨æ•°æ®ï¼‰ï¼Œæ²¡æœ‰åŒ…å« `user_feedback` è¡¨ã€‚

**åŽŸå§‹è®¾è®¡æ„å›¾**ï¼ˆä»Ž `sync-from-turso.js:7-10` æ³¨é‡Šï¼‰ï¼š
```javascript
/**
 * åŠŸèƒ½ï¼š
 * - åªåŒæ­¥ events è¡¨ï¼ˆæ´»åŠ¨æ•°æ®ï¼‰
 * - ä¸è§¦ç¢° feedback è¡¨ï¼ˆposts, event_performance, weight_adjustmentsï¼‰
 */
```

è¿™é‡Œçš„ "feedback è¡¨" æŒ‡çš„æ˜¯æ—§çš„æœ¬åœ°åé¦ˆè¡¨ï¼ˆ`posts`, `event_performance`, `weight_adjustments`ï¼‰ï¼Œä¸åŒ…æ‹¬æ–°çš„ `user_feedback` è¡¨ã€‚

### å½±å“èŒƒå›´

**æ— æ³•åŒæ­¥ä¼šå¯¼è‡´**ï¼š
1. æœ¬åœ°æ— æ³•åˆ†æžç”¨æˆ·åé¦ˆæ•°æ®
2. å¦‚æžœæœ‰æœ¬åœ°åˆ†æžè„šæœ¬ä¾èµ– `user_feedback`ï¼Œå°†æ— æ³•å·¥ä½œ
3. æ•°æ®åªå­˜åœ¨äº‘ç«¯ï¼Œæœ¬åœ°æŸ¥è¯¢ä¸åˆ°

**ç›®å‰ä¸å—å½±å“çš„åŠŸèƒ½**ï¼š
- Website æ­£å¸¸è¿è¡Œï¼ˆç›´æŽ¥è¯»å†™ Tursoï¼‰
- ç”¨æˆ·åé¦ˆåŠŸèƒ½æ­£å¸¸ï¼ˆå†™å…¥ Tursoï¼‰

### è§£å†³æ–¹æ¡ˆå»ºè®®

#### æ–¹æ¡ˆ Aï¼šæ·»åŠ  user_feedback åˆ° sync-from-turso.jsï¼ˆæŽ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- ä¿æŒå•å‘åŒæ­¥ç­–ç•¥ä¸€è‡´æ€§
- æœ¬åœ°å¯ä»¥åˆ†æžåé¦ˆæ•°æ®
- å®Œæ•´çš„æ•°æ®å‰¯æœ¬

**å®žçŽ°è¦ç‚¹**ï¼š
1. åœ¨ `fetchFromTurso()` ä¸­æ·»åŠ  `user_feedback` è¡¨æŸ¥è¯¢
2. æ·»åŠ  `syncUserFeedback()` æ–¹æ³•
3. ä½¿ç”¨ `id` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆAUTOINCREMENTï¼‰
4. æ”¯æŒå¢žé‡åŒæ­¥ï¼ˆåŸºäºŽ `created_at`ï¼‰

**æ³¨æ„äº‹é¡¹**ï¼š
- ä¸èƒ½ä½¿ç”¨ `original_url` åŽ»é‡ï¼ˆuser_feedback æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼‰
- åº”è¯¥ç”¨ `id` ä½œä¸ºä¸»é”®åˆ¤æ–­
- æˆ–è€…ç”¨ `(session_id, created_at)` ç»„åˆåˆ¤æ–­

#### æ–¹æ¡ˆ Bï¼šä¿æŒçŽ°çŠ¶ï¼Œæœ¬åœ°ä¸éœ€è¦ user_feedback

**é€‚ç”¨åœºæ™¯**ï¼š
- æ‰€æœ‰åé¦ˆåˆ†æžéƒ½åœ¨ Turso ä¸Šè¿›è¡Œ
- æœ¬åœ°ä¸éœ€è¦è®¿é—®åé¦ˆæ•°æ®
- Website å·²ç»æä¾›äº†æŸ¥è¯¢æŽ¥å£ï¼ˆ`GET /api/feedback`ï¼‰

#### æ–¹æ¡ˆ Cï¼šåŒå‘åŒæ­¥ï¼ˆä¸æŽ¨èï¼‰

å¤æ‚åº¦é«˜ï¼Œä¸Žå½“å‰æž¶æž„ä¸ç¬¦ã€‚

---

## é—®é¢˜ 2: remove-duplicates.js è„šæœ¬

### çŽ°çŠ¶åˆ†æž

#### è„šæœ¬åŠŸèƒ½ï¼ˆ`remove-duplicates.js:1-186`ï¼‰

**ç›®æ ‡**ï¼šåˆ é™¤æœ¬åœ°æ•°æ®åº“ä¸­çš„é‡å¤æ´»åŠ¨

**å®žçŽ°**ï¼š
1. è¿žæŽ¥æœ¬åœ° SQLiteï¼š`data/events.db`
2. åˆ é™¤æ— æ•ˆæ´»åŠ¨ï¼ˆæ ‡é¢˜æ˜¯ç½‘ç«™åŸŸåçš„ï¼‰
3. æŒ‰ `normalized_title` åˆ†ç»„æŸ¥æ‰¾é‡å¤
4. ä¿ç•™ä¼˜å…ˆçº§æœ€é«˜æˆ– ID æœ€å°çš„æ´»åŠ¨
5. åˆ é™¤å…¶ä»–é‡å¤é¡¹

**å…³é”®ä»£ç **ï¼ˆ`remove-duplicates.js:10-11`ï¼‰ï¼š
```javascript
const dbPath = path.join(__dirname, 'data', 'events.db');
const db = new Database(dbPath);
```

### é—®é¢˜æ ¹æº

#### é—®é¢˜ 1ï¼šåªæ“ä½œæœ¬åœ°æ•°æ®åº“

è„šæœ¬**ç¡¬ç¼–ç **äº†æœ¬åœ° SQLite è·¯å¾„ï¼Œå®Œå…¨æ²¡æœ‰ Turso æ”¯æŒï¼š
- âŒ ä¸è¯»å– `.env` é…ç½®
- âŒ ä¸æ£€æŸ¥ `USE_TURSO` çŽ¯å¢ƒå˜é‡
- âŒ ä¸ä½¿ç”¨ `@libsql/client`
- âŒ åªæ“ä½œ `data/events.db`

**ç»“æžœ**ï¼š
```
scrape â†’ Turso (äº§ç”Ÿé‡å¤æ•°æ®)
  â†“
  âŒ remove-duplicates.js åªåŽ»é‡æœ¬åœ°
  â†“
  Turso çš„é‡å¤æ•°æ®ä¾ç„¶å­˜åœ¨
```

#### é—®é¢˜ 2ï¼šè„šæœ¬ä¸ºä»€ä¹ˆ"ç”¨ä¸èµ·æ¥"ï¼Ÿ

**å¯èƒ½çš„åŽŸå› **ï¼š

1. **æ•°æ®ä¸åœ¨æœ¬åœ°**
   - å¦‚æžœç”¨æˆ·è®¾ç½®äº† `USE_TURSO=1`
   - scraper å†™å…¥ Turso
   - æœ¬åœ°æ•°æ®åº“æ˜¯ç©ºçš„æˆ–è¿‡æ—¶çš„
   - è„šæœ¬è¿è¡Œæ²¡æœ‰æ•ˆæžœï¼ˆæ²¡æœ‰æ•°æ®å¯åŽ»é‡ï¼‰

2. **è„šæœ¬æœ¬èº«çš„é€»è¾‘é—®é¢˜**
   - ä½¿ç”¨ `GROUP_CONCAT()` å¯èƒ½æœ‰é•¿åº¦é™åˆ¶
   - å¼‚æ­¥å›žè°ƒåµŒå¥—å¯èƒ½æœ‰ race condition
   - `finishUp()` çš„ `setTimeout(500)` å¯èƒ½ä¸å¤Ÿ

3. **UNIQUE çº¦æŸå†²çª**
   - events è¡¨æœ‰ UNIQUE çº¦æŸï¼š`(normalized_title, start_time, location)`
   - ç†è®ºä¸Šä¸åº”è¯¥äº§ç”Ÿé‡å¤
   - å¦‚æžœæœ‰é‡å¤ï¼Œè¯´æ˜Žè¿™ä¸‰ä¸ªå­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸åŒ

### é‡å¤æ•°æ®äº§ç”Ÿçš„åŽŸå› 

**events è¡¨ UNIQUE çº¦æŸ**ï¼ˆ`complete_schema.sql:21`ï¼‰ï¼š
```sql
UNIQUE(normalized_title, start_time, location)
```

**å¦‚æžœæœ‰é‡å¤ï¼Œå¯èƒ½æ˜¯**ï¼š
1. `start_time` æ ¼å¼ä¸ä¸€è‡´ï¼ˆæ—¶åŒºã€æ ¼å¼å·®å¼‚ï¼‰
2. `location` æ–‡æœ¬ç»†å¾®å·®å¼‚ï¼ˆç©ºæ ¼ã€å¤§å°å†™ã€ç¼©å†™ï¼‰
3. `normalized_title` è§„èŒƒåŒ–ä¸å¤Ÿå½»åº•
4. ä¸åŒæ¥æºçš„ç›¸åŒæ´»åŠ¨ï¼Œå­—æ®µå€¼ç•¥æœ‰ä¸åŒ

### è§£å†³æ–¹æ¡ˆå»ºè®®

#### æ–¹æ¡ˆ Aï¼šæ”¯æŒ Turso çš„åŽ»é‡è„šæœ¬ï¼ˆæŽ¨èï¼‰

**æ–°å»º** `remove-duplicates-turso.js`ï¼š
- è¯»å– `.env` é…ç½®
- æ ¹æ® `USE_TURSO` å†³å®šæ“ä½œå“ªä¸ªæ•°æ®åº“
- ä½¿ç”¨ `@libsql/client` è¿žæŽ¥ Turso
- ä¿æŒç›¸åŒçš„åŽ»é‡é€»è¾‘

**ä¼˜ç‚¹**ï¼š
- ç›´æŽ¥åœ¨æºå¤´åŽ»é‡ï¼ˆTursoï¼‰
- ä¿ç•™æ—§è„šæœ¬å‘åŽå…¼å®¹
- æ¸…æ™°æ˜Žç¡®

#### æ–¹æ¡ˆ Bï¼šæ”¹è¿›çŽ°æœ‰è„šæœ¬

ä¿®æ”¹ `remove-duplicates.js`ï¼š
- æ·»åŠ çŽ¯å¢ƒå˜é‡æ£€æµ‹
- åŠ¨æ€é€‰æ‹©æ•°æ®åº“
- ç»Ÿä¸€æŽ¥å£

**ç¼ºç‚¹**ï¼š
- sqlite3 å’Œ @libsql/client API ä¸åŒ
- éœ€è¦é€‚é…ä¸¤å¥— API
- ä»£ç å¤æ‚åº¦å¢žåŠ 

#### æ–¹æ¡ˆ Cï¼šä»Žæ ¹æœ¬ä¸Šé˜²æ­¢é‡å¤

**åœ¨ scraper å±‚é¢**ï¼š
1. æ”¹è¿› `normalized_title` ç®—æ³•
2. ç»Ÿä¸€ `start_time` æ ¼å¼
3. æ¸…ç† `location` æ–‡æœ¬
4. ä½¿ç”¨ `original_url` ä½œä¸ºå”¯ä¸€æ ‡è¯†

**åœ¨æ•°æ®åº“å±‚é¢**ï¼š
```sql
-- æ”¹è¿› UNIQUE çº¦æŸ
UNIQUE(source, original_url)
-- æˆ–è€…åªç”¨ original_url
UNIQUE(original_url)
```

**ä¼˜ç‚¹**ï¼š
- é¢„é˜²èƒœäºŽæ²»ç–—
- ä¸éœ€è¦äº‹åŽåŽ»é‡

**ç¼ºç‚¹**ï¼š
- éœ€è¦ä¿®æ”¹ schemaï¼ˆå·²æœ‰æ•°æ®è¿ç§»ï¼‰
- `original_url` å¯èƒ½å˜åŒ–ï¼ˆåŠ¨æ€ç”Ÿæˆçš„ URLï¼‰

#### æ–¹æ¡ˆ Dï¼šå®šæœŸè‡ªåŠ¨åŽ»é‡

åœ¨ scraper æµç¨‹ä¸­é›†æˆåŽ»é‡ï¼š
```bash
npm run scrape && npm run remove-duplicates-turso
```

**package.json**ï¼š
```json
"scrape-and-clean": "npm run scrape && npm run remove-duplicates-turso"
```

---

## æŠ€æœ¯ç»†èŠ‚å¯¹æ¯”

### events è¡¨ vs user_feedback è¡¨

| ç‰¹æ€§ | events | user_feedback |
|------|--------|---------------|
| **æ•°æ®æ¥æº** | Scraper | Website ç”¨æˆ·äº¤äº’ |
| **å†™å…¥é¢‘çŽ‡** | æ¯å‘¨ 1 æ¬¡ | æŒç»­ä¸æ–­ |
| **æ•°æ®é‡** | å‡ ç™¾åˆ°ä¸Šåƒæ¡/å‘¨ | å–å†³äºŽæµé‡ |
| **å”¯ä¸€æ ‡è¯†** | `original_url` | `id` æˆ– `(session_id, created_at)` |
| **æ˜¯å¦æœ‰é‡å¤é£Žé™©** | æœ‰ï¼ˆéœ€è¦åŽ»é‡ï¼‰ | æ— ï¼ˆæ¯æ¬¡éƒ½æ˜¯æ–°è®°å½•ï¼‰ |
| **å½“å‰åŒæ­¥çŠ¶æ€** | âœ… å·²åŒæ­¥ | âŒ æœªåŒæ­¥ |

### åŽ»é‡é€»è¾‘å¯¹æ¯”

#### å½“å‰ remove-duplicates.js
```javascript
// 1. æŒ‰ normalized_title åˆ†ç»„
GROUP BY normalized_title HAVING COUNT(*) > 1

// 2. ä¿ç•™è§„åˆ™
ä¿ç•™: MAX(priority) æˆ– MIN(id)

// 3. åˆ é™¤å…¶ä»–
DELETE FROM events WHERE id IN (...)
```

#### ç†æƒ³çš„åŽ»é‡é€»è¾‘
```javascript
// 1. æŒ‰çœŸæ­£çš„å”¯ä¸€æ ‡è¯†åˆ†ç»„
GROUP BY source, original_url HAVING COUNT(*) > 1

// 2. ä¿ç•™è§„åˆ™
ä¿ç•™: æœ€æ–°çš„ scraped_at

// 3. åˆ é™¤å…¶ä»–
```

---

## æŽ¨èå®žçŽ°è®¡åˆ’

### çŸ­æœŸï¼ˆç«‹å³å®žæ–½ï¼‰

1. **æ·»åŠ  user_feedback åŒæ­¥**
   - ä¿®æ”¹ `sync-from-turso.js`
   - æ·»åŠ  `syncUserFeedback()` æ–¹æ³•
   - æ›´æ–°æ–‡æ¡£

2. **åˆ›å»º Turso åŽ»é‡è„šæœ¬**
   - æ–°å»º `remove-duplicates-turso.js`
   - æ”¯æŒ `USE_TURSO` çŽ¯å¢ƒå˜é‡
   - æ·»åŠ åˆ° `package.json` è„šæœ¬

### ä¸­æœŸï¼ˆä¼˜åŒ–æ”¹è¿›ï¼‰

3. **æ”¹è¿›åŽ»é‡é€»è¾‘**
   - ä½¿ç”¨ `original_url` ä½œä¸ºå”¯ä¸€æ ‡è¯†
   - ç»Ÿä¸€ `start_time` æ ¼å¼
   - æ¸…ç† `location` æ–‡æœ¬

4. **é›†æˆåˆ°å·¥ä½œæµ**
   - scraper åŽè‡ªåŠ¨åŽ»é‡
   - åŒæ­¥å‰è‡ªåŠ¨åŽ»é‡

### é•¿æœŸï¼ˆæž¶æž„ä¼˜åŒ–ï¼‰

5. **Schema æ”¹è¿›**
   - ä¿®æ”¹ UNIQUE çº¦æŸä¸º `(source, original_url)`
   - è¿ç§»çŽ°æœ‰æ•°æ®

6. **ç›‘æŽ§å’Œå‘Šè­¦**
   - ç›‘æŽ§é‡å¤æ•°æ®äº§ç”Ÿ
   - å®šæœŸæŠ¥å‘Šæ•°æ®è´¨é‡

---

## ç›¸å…³æ–‡ä»¶

### user_feedback ç›¸å…³
- `website/lib/turso-feedback.ts` - Turso å†™å…¥é€»è¾‘
- `website/app/api/feedback/route.ts` - API ç«¯ç‚¹
- `init-user-feedback-db.js` - æœ¬åœ°è¡¨åˆå§‹åŒ–
- `complete_schema.sql` - å®Œæ•´ schema

### åŒæ­¥ç›¸å…³
- `sync-from-turso.js` - å½“å‰åŒæ­¥è„šæœ¬ï¼ˆåªåŒæ­¥ eventsï¼‰
- `package.json:25` - `sync-from-turso` è„šæœ¬

### åŽ»é‡ç›¸å…³
- `remove-duplicates.js` - å½“å‰åŽ»é‡è„šæœ¬ï¼ˆåªæ”¯æŒæœ¬åœ°ï¼‰

### æ–‡æ¡£
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `docs/DATA_ARCHITECTURE.md` - æ•°æ®æž¶æž„æ–‡æ¡£

---

## ç»“è®º

### user_feedback åŒæ­¥
- **é—®é¢˜æ˜Žç¡®**ï¼šéœ€è¦æ·»åŠ åˆ°åŒæ­¥è„šæœ¬
- **å½±å“æœ‰é™**ï¼šç›®å‰ä¸å½±å“ Website è¿è¡Œ
- **è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `sync-from-turso.js` æ·»åŠ  user_feedback è¡¨åŒæ­¥
- **âœ… çŠ¶æ€**ï¼šå·²å®Œæˆå®žçŽ°ï¼ˆ2025-12-10ï¼‰

### remove-duplicates.js
- **æ ¹æœ¬åŽŸå› **ï¼šåªæ”¯æŒæœ¬åœ°æ•°æ®åº“ï¼Œä¸æ”¯æŒ Turso
- **æ¬¡è¦åŽŸå› **ï¼šåŽ»é‡é€»è¾‘å¯èƒ½ä¸å¤Ÿå‡†ç¡®
- **è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºæ”¯æŒ Turso çš„ç‰ˆæœ¬ï¼Œæ”¹è¿›åŽ»é‡é€»è¾‘
- **âœ… çŠ¶æ€**ï¼šå·²å®Œæˆå®žçŽ°ï¼ˆ2025-12-10ï¼‰

### ä¼˜å…ˆçº§
1. âœ… ~~é«˜ä¼˜å…ˆçº§ï¼šæ·»åŠ  user_feedback åŒæ­¥ï¼ˆå®Œå–„æ•°æ®åŒæ­¥ï¼‰~~ - å·²å®Œæˆ
2. âœ… ~~é«˜ä¼˜å…ˆçº§ï¼šåˆ›å»º Turso åŽ»é‡è„šæœ¬ï¼ˆç«‹å³è§£å†³ç”¨æˆ·é—®é¢˜ï¼‰~~ - å·²å®Œæˆ
3. âœ… ~~ä¸­ä¼˜å…ˆçº§ï¼šæ”¹è¿›åŽ»é‡é€»è¾‘ï¼ˆæé«˜å‡†ç¡®æ€§ï¼‰~~ - å·²å®Œæˆ
4. ðŸ’¡ ä½Žä¼˜å…ˆçº§ï¼šSchema ä¼˜åŒ–ï¼ˆé•¿æœŸæ”¹è¿›ï¼‰ - å¾…å®žçŽ°

---

## å®žæ–½è®°å½•

### 2025-12-10: user_feedback åŒæ­¥åŠŸèƒ½å·²å®Œæˆ

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `sync-from-turso.js` - æ·»åŠ äº† user_feedback è¡¨çš„åŒæ­¥åŠŸèƒ½

**æ–°å¢žçš„æ–¹æ³•**:
1. `getLastFeedbackSyncTime()` - èŽ·å–ä¸Šæ¬¡åŒæ­¥çš„ user_feedback æ—¶é—´
2. `fetchFeedbackFromTurso(sinceTime)` - ä»Ž Turso èŽ·å– user_feedback æ•°æ®
3. `syncFeedbackToLocal(feedback, mode)` - åŒæ­¥ user_feedback åˆ°æœ¬åœ°
4. `upsertFeedback(feedback)` - æ’å…¥æˆ–æ›´æ–° user_feedback è®°å½•
5. `clearLocalFeedback()` - æ¸…ç©ºæœ¬åœ° user_feedback è¡¨ï¼ˆå…¨é‡åŒæ­¥ç”¨ï¼‰
6. `previewFeedbackData(feedback)` - é¢„è§ˆ user_feedback æ•°æ®

**åŒæ­¥ç­–ç•¥**:
- ä½¿ç”¨ `id` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆä¿ç•™ Turso çš„ AUTOINCREMENT idï¼‰
- æ”¯æŒå¢žé‡åŒæ­¥ï¼ˆåŸºäºŽ `created_at` æ—¶é—´æˆ³ï¼‰
- æ”¯æŒå…¨é‡åŒæ­¥ï¼ˆæ¸…ç©ºå¹¶é‡æ–°å¯¼å…¥ï¼‰
- Upsert é€»è¾‘ï¼šå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥

**æ–‡æ¡£æ›´æ–°**:
- æ›´æ–°äº† `sync-from-turso.js` çš„å¸®åŠ©æ–‡æ¡£
- æ›´æ–°äº† `QUICK_START.md` çš„æ•°æ®åº“è¯´æ˜Ž
- æ›´æ–°äº† `docs/DATA_ARCHITECTURE.md` çš„æ•°æ®åˆ†å±‚è¯´æ˜Ž

**æµ‹è¯•**:
- âœ… JavaScript è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… å¸®åŠ©æ–‡æ¡£æ˜¾ç¤ºæ­£å¸¸
- âœ… æœ¬åœ°æ•°æ®åº“ç¡®è®¤æœ‰ user_feedback è¡¨ï¼ˆ2 æ¡è®°å½•ï¼‰
- âš ï¸ å®Œæ•´åŒæ­¥æµ‹è¯•éœ€è¦æœ‰æ•ˆçš„ Turso é…ç½®

---

### 2025-12-10: Turso åŽ»é‡è„šæœ¬å·²å®Œæˆ

**æ–°å»ºçš„æ–‡ä»¶**:
- `remove-duplicates-turso.js` - æ”¯æŒ Turso çš„åŽ»é‡è„šæœ¬
- `DEDUPLICATION_GUIDE.md` - è¯¦ç»†çš„åŽ»é‡åŠŸèƒ½ä½¿ç”¨æŒ‡å—

**æ ¸å¿ƒåŠŸèƒ½**:
1. **åŒæ•°æ®åº“æ”¯æŒ**: è‡ªåŠ¨æ£€æµ‹ `USE_TURSO` çŽ¯å¢ƒå˜é‡
   - USE_TURSO=1: æ“ä½œ Turso äº‘ç«¯æ•°æ®åº“
   - USE_TURSO=0 æˆ–æœªè®¾ç½®: æ“ä½œæœ¬åœ° SQLite

2. **æ”¹è¿›çš„åŽ»é‡é€»è¾‘**:
   - é»˜è®¤ä½¿ç”¨ `original_url` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆæ¯” normalized_title æ›´å‡†ç¡®ï¼‰
   - æ”¯æŒ `--dedupe-by=normalized_title` å…¼å®¹æ—§é€»è¾‘
   - ä¼˜å…ˆä¿ç•™ priority æœ€é«˜æˆ– scraped_at æœ€æ–°çš„æ´»åŠ¨

3. **å®‰å…¨ç‰¹æ€§**:
   - `--dry-run` é¢„è§ˆæ¨¡å¼ï¼ŒæŸ¥çœ‹å°†è¦åˆ é™¤çš„æ•°æ®
   - æ™ºèƒ½é…ç½®æ£€æµ‹ï¼Œå ä½ç¬¦è‡ªåŠ¨å›žé€€åˆ°æœ¬åœ°æ•°æ®åº“
   - è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯å’Œæ“ä½œæ—¥å¿—

4. **æ— æ•ˆæ´»åŠ¨æ¸…ç†**:
   - è‡ªåŠ¨åˆ é™¤æ ‡é¢˜æ˜¯åŸŸåçš„æ´»åŠ¨ï¼ˆwww.sfstation.com ç­‰ï¼‰

**npm è„šæœ¬**:
- `npm run remove-duplicates` - åˆ é™¤é‡å¤æ´»åŠ¨
- `npm run remove-duplicates-preview` - é¢„è§ˆæ¨¡å¼
- `npm run remove-duplicates-by-title` - ä½¿ç”¨æ ‡é¢˜åŽ»é‡

**åŽ»é‡ç­–ç•¥**:
```javascript
// å¯¹æ¯ç»„é‡å¤æ´»åŠ¨
1. æ¯”è¾ƒ priorityï¼ˆä¼˜å…ˆçº§ï¼‰
   â†’ ä¿ç•™ priority æœ€é«˜çš„

2. å¦‚æžœ priority ç›¸åŒï¼Œæ¯”è¾ƒ scraped_atï¼ˆæŠ“å–æ—¶é—´ï¼‰
   â†’ ä¿ç•™æœ€æ–°æŠ“å–çš„

3. åˆ é™¤å…¶ä»–é‡å¤é¡¹
```

**æ–‡æ¡£æ›´æ–°**:
- åˆ›å»ºäº† `DEDUPLICATION_GUIDE.md` - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- æ›´æ–°äº† `QUICK_START.md` - æ·»åŠ åŽ»é‡å‘½ä»¤
- æ›´æ–°äº† `package.json` - æ·»åŠ  3 ä¸ªåŽ»é‡è„šæœ¬
- æ›´æ–°äº†è°ƒæŸ¥æŠ¥å‘ŠçŠ¶æ€

**æµ‹è¯•**:
- âœ… JavaScript è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… å¸®åŠ©æ–‡æ¡£æ˜¾ç¤ºæ­£å¸¸
- âœ… é¢„è§ˆæ¨¡å¼æµ‹è¯•é€šè¿‡ï¼ˆæœ¬åœ°æ•°æ®åº“ 480 æ¡è®°å½•ï¼Œ0 é‡å¤ï¼‰
- âœ… npm è„šæœ¬æµ‹è¯•é€šè¿‡
- âœ… æ™ºèƒ½é…ç½®å›žé€€æµ‹è¯•é€šè¿‡
- âš ï¸ Turso å®žé™…åŽ»é‡æµ‹è¯•éœ€è¦æœ‰æ•ˆé…ç½®
>>>>>>> 6f2e5a43aa019e14f8fb7c1cf255d17b73271d01
