# Sprint 1.5 å®Œæˆæ€»ç»“

## æ¦‚è¿°

**Sprint 1.5** æ‰©å±•äº†åé¦ˆé—­ç¯ç³»ç»Ÿï¼Œæ”¯æŒ**å¤šæ¬¡çˆ¬å–åˆå¹¶æˆä¸€ä¸ªå¸–å­**çš„åœºæ™¯ã€‚è¿™æ˜¯å¯¹ Sprint 1 çš„é‡è¦å¢å¼ºï¼Œè§£å†³äº†å®é™…ä½¿ç”¨ä¸­å‡ ä¹æ¯æ¬¡éƒ½éœ€è¦å¤šæ¬¡çˆ¬å–æ‰èƒ½æ”¶é›†è¶³å¤Ÿæ´»åŠ¨çš„é—®é¢˜ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½Reviewæ–‡ä»¶åˆ†ç»„

- **åŸºäºæ´»åŠ¨æ—¶é—´èŒƒå›´åˆ†ç»„**: è‡ªåŠ¨è¯»å– review æ–‡ä»¶ä¸­çš„ `target_week` å­—æ®µï¼Œå°†ç›¸åŒæ—¶é—´æ®µçš„reviewåˆ†ä¸ºä¸€ç»„
- **æ”¯æŒå¤šæ¥æºåˆå¹¶**: å¯ä»¥åˆå¹¶2ä¸ªæˆ–æ›´å¤šreviewæ–‡ä»¶çš„æ´»åŠ¨åˆ—è¡¨
- **è‡ªåŠ¨å»é‡**: ä½¿ç”¨ 80% title ç›¸ä¼¼åº¦ + åœ°ç‚¹åŒ¹é…ç®—æ³•ï¼Œè‡ªåŠ¨ç§»é™¤é‡å¤æ´»åŠ¨

### 2. äº¤äº’å¼é€‰æ‹©ç•Œé¢

ç”¨æˆ·è¿è¡Œ `npm run generate-post` (ä¸å¸¦å‚æ•°)ï¼Œç³»ç»Ÿè‡ªåŠ¨ï¼š

```
ğŸ” æ‰«æ output ç›®å½•çš„ review æ–‡ä»¶

ğŸ“‹ æŒ‰ target_week åˆ†ç»„æ˜¾ç¤ºï¼š
  ã€ç¬¬1ç»„: 11/10 - 11/16ã€‘
    âœ“ review_2025-11-03_1341.json (38ä¸ªæ´»åŠ¨)
    âœ“ review_2025-11-03_1430.json (25ä¸ªæ´»åŠ¨)

  ã€ç¬¬2ç»„: 11/17 - 11/23ã€‘
    âœ“ review_2025-11-10_0900.json (42ä¸ªæ´»åŠ¨)

âŒ¨ï¸ ç”¨æˆ·é€‰æ‹©è¦ç”Ÿæˆçš„æ—¶é—´æ®µ

ğŸ”„ è‡ªåŠ¨åˆå¹¶ + å»é‡

ğŸ“Š æ˜¾ç¤ºåˆå¹¶ç»“æœç»Ÿè®¡

âœ… ç”Ÿæˆå¸–å­
```

### 3. æ¥æºè¿½è¸ª

ç³»ç»Ÿè®°å½•æ¯ä¸ªæ´»åŠ¨çš„è¯¦ç»†æ¥æºï¼š

- **å¸–å­çº§åˆ«**: è®°å½•ç”±å“ªå‡ ä¸ª review æ–‡ä»¶ç»„æˆ
- **æ´»åŠ¨çº§åˆ«**: è®°å½•æ¯ä¸ªæ´»åŠ¨æ¥è‡ªå“ªä¸ª review æ–‡ä»¶ã€æ¥è‡ªå“ªä¸ªç½‘ç«™

è¿™ä¸ºåç»­åé¦ˆåˆ†ææä¾›äº†æ•°æ®åŸºç¡€ã€‚

---

## ğŸ“Š æ•°æ®åº“æ‰©å±•

### Schema v1.5 æ–°å¢å­—æ®µ

**posts è¡¨**:
```sql
source_reviews TEXT      -- JSONæ•°ç»„ï¼Œè®°å½•æ¥æºreviewæ–‡ä»¶
is_merged_post INTEGER   -- æ˜¯å¦ä¸ºåˆå¹¶å¸–å­ (0/1)
```

**event_performance è¡¨**:
```sql
source_review TEXT       -- æ¥è‡ªå“ªä¸ªreviewæ–‡ä»¶
source_website TEXT      -- æ¥æºç½‘ç«™ (eventbrite/funcheap/meetupç­‰)
```

### è‡ªåŠ¨è¿ç§»

ç³»ç»Ÿåœ¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ‰§è¡Œè¿ç§»ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

---

## ğŸ¨ æŠ€æœ¯å®ç°

### æ–°å¢æ¨¡å—

**`src/utils/review-merger.js`** (~300è¡Œ)
- `scanReviewFiles()`: æ‰«æoutputç›®å½•
- `groupByTargetWeek()`: æŒ‰æ—¶é—´èŒƒå›´åˆ†ç»„
- `selectReviewGroup()`: äº¤äº’å¼é€‰æ‹©
- `mergeReviewFiles()`: åˆå¹¶reviewå†…å®¹
- `deduplicateEvents()`: æ´»åŠ¨å»é‡
- `areEventsSimilar()`: ç›¸ä¼¼åº¦åˆ¤æ–­
- `calculateStringSimilarity()`: Jaccardç›¸ä¼¼åº¦ç®—æ³•

### ä¿®æ”¹çš„æ–‡ä»¶

**`src/feedback/schema-v1.5.sql`** (æ–°å»º)
- æ•°æ®åº“è¿ç§»è„šæœ¬

**`src/feedback/performance-database.js`** (~+100è¡Œ)
- æ–°å¢ `migrateToV15()` æ–¹æ³•
- æ›´æ–° `createPost()` æ”¯æŒæ–°å­—æ®µ
- æ›´æ–° `createEventPerformance()` æ”¯æŒæ–°å­—æ®µ

**`src/generate-post.js`** (~+80è¡Œ)
- æ–°å¢äº¤äº’å¼é€‰æ‹©æ¨¡å¼
- é›†æˆ ReviewMerger
- ä¼ é€’æ¥æºä¿¡æ¯åˆ°æ•°æ®åº“
- å…¼å®¹ä¼ ç»Ÿå•æ–‡ä»¶æ¨¡å¼

---

## ğŸ“ˆ ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: äº¤äº’å¼é€‰æ‹©ï¼ˆæ¨èï¼‰

```bash
# ä¸å¸¦ä»»ä½•å‚æ•°
npm run generate-post

# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# 1. æ‰«æ output ç›®å½•çš„æ‰€æœ‰ review æ–‡ä»¶
# 2. æŒ‰ target_week åˆ†ç»„æ˜¾ç¤º
# 3. è®©ç”¨æˆ·é€‰æ‹©è¦ç”Ÿæˆçš„æ—¶é—´æ®µ
# 4. è‡ªåŠ¨åˆå¹¶ + å»é‡
# 5. ç”Ÿæˆå¸–å­
```

### æ–¹å¼2: ä¼ ç»Ÿå•æ–‡ä»¶æ¨¡å¼

```bash
# æŒ‡å®šå•ä¸ª review æ–‡ä»¶
npm run generate-post ./output/review_2025-11-03_1341.json

# å’Œä¹‹å‰çš„ç”¨æ³•å®Œå…¨ä¸€æ ·
```

---

## ğŸ” å»é‡ç®—æ³•

### åˆ¤æ–­æ ‡å‡†

ä¸¤ä¸ªæ´»åŠ¨è¢«è®¤ä¸ºæ˜¯é‡å¤çš„ï¼Œå¦‚æœï¼š

1. **Titleç›¸ä¼¼åº¦ >= 80%** (ä½¿ç”¨ Jaccard ç›¸ä¼¼åº¦)
2. **åœ°ç‚¹åŒ¹é…** (æ ‡å‡†åŒ–åå®Œå…¨ç›¸åŒ)

### ç¤ºä¾‹

```
æ´»åŠ¨1: "Golden Gate Park Concert"
       åœ°ç‚¹: "Golden Gate Park, San Francisco"

æ´»åŠ¨2: "Golden Gate Park Free Concert"
       åœ°ç‚¹: "Golden Gate Park, SF"

â†’ Titleç›¸ä¼¼åº¦: 85%
â†’ åœ°ç‚¹åŒ¹é…: æ˜¯
â†’ åˆ¤å®šä¸ºé‡å¤ï¼Œä¿ç•™ç¬¬1ä¸ª
```

---

## ğŸ“Š æ•°æ®ç¤ºä¾‹

### posts è¡¨è®°å½•

```json
{
  "post_id": "post_2025-11-04T10-30",
  "week_identifier": "2025-11-10_to_2025-11-16",
  "total_events": 45,
  "is_merged_post": 1,
  "source_reviews": "[
    {\"file\": \"review_2025-11-03_1341.json\", \"event_count\": 25, \"scraped_at\": \"...\"},
    {\"file\": \"review_2025-11-03_1430.json\", \"event_count\": 20, \"scraped_at\": \"...\"}
  ]"
}
```

### event_performance è¡¨è®°å½•

```json
{
  "post_id": "post_2025-11-04T10-30",
  "event_title": "Golden Gate Park Concert",
  "source_review": "review_2025-11-03_1341.json",
  "source_website": "eventbrite",
  "shortio_clicks": 0,
  ...
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [x] å¯ä»¥æ‰«æ output ç›®å½•çš„æ‰€æœ‰ review æ–‡ä»¶
- [x] å¯ä»¥æŒ‰ target_week æ­£ç¡®åˆ†ç»„
- [x] äº¤äº’å¼é€‰æ‹©ç•Œé¢æ¸…æ™°æ˜“ç”¨
- [x] å¯ä»¥åˆå¹¶å¤šä¸ª review æ–‡ä»¶
- [x] å»é‡ç®—æ³•å‡†ç¡®æœ‰æ•ˆ
- [x] æ¥æºä¿¡æ¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
- [x] å…¼å®¹ä¼ ç»Ÿå•æ–‡ä»¶æ¨¡å¼

### æ•°æ®éªŒæ”¶

- [x] posts è¡¨æ–°å¢ `source_reviews` å’Œ `is_merged_post` å­—æ®µ
- [x] event_performance è¡¨æ–°å¢ `source_review` å’Œ `source_website` å­—æ®µ
- [x] schema_version è¡¨è®°å½• v1.5.0
- [x] æ•°æ®åº“è¿ç§»è‡ªåŠ¨æ‰§è¡Œ

### ä»£ç è´¨é‡

- [x] ä»£ç æœ‰è¯¦ç»†æ³¨é‡Š
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] å‘åå…¼å®¹ Sprint 1 çš„åŠŸèƒ½
- [x] æ— ç ´åæ€§å˜æ›´

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. æ•°æ®åº“è¿ç§»æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test-sprint1.5.sh

# æˆ–æ‰‹åŠ¨æµ‹è¯•
node init-feedback-db.js

# æ£€æŸ¥æ–°å­—æ®µ
sqlite3 ./data/events.db "PRAGMA table_info(posts);"
sqlite3 ./data/events.db "PRAGMA table_info(event_performance);"
```

### 2. äº¤äº’å¼é€‰æ‹©æµ‹è¯•

```bash
# ç¡®ä¿æœ‰å¤šä¸ª review æ–‡ä»¶
ls ./output/review_*.json

# è¿è¡Œäº¤äº’å¼é€‰æ‹©
npm run generate-post

# åº”è¯¥çœ‹åˆ°åˆ†ç»„ç•Œé¢ï¼Œå¯ä»¥é€‰æ‹©æ—¶é—´æ®µ
```

### 3. å»é‡æµ‹è¯•

åˆ›å»ºä¸¤ä¸ªåŒ…å«ç›¸åŒæ´»åŠ¨çš„ review æ–‡ä»¶ï¼Œè¿è¡Œåˆå¹¶ï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®å»é‡ã€‚

### 4. æ•°æ®éªŒè¯

```bash
# ç”Ÿæˆå¸–å­åï¼Œæ£€æŸ¥æ•°æ®åº“
sqlite3 ./data/events.db "SELECT post_id, is_merged_post, source_reviews FROM posts ORDER BY published_at DESC LIMIT 1;"

sqlite3 ./data/events.db "SELECT event_title, source_review, source_website FROM event_performance WHERE post_id = 'post_XXX';"
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. Reviewæ–‡ä»¶æ ¼å¼ä¾èµ–

ç³»ç»Ÿä¾èµ– review æ–‡ä»¶ä¸­çš„ `target_week` å­—æ®µã€‚å¦‚æœæŸä¸ª review æ–‡ä»¶ç¼ºå°‘è¿™ä¸ªå­—æ®µï¼Œä¼šè¢«è‡ªåŠ¨è¿‡æ»¤æ‰ã€‚

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ scraper ç”Ÿæˆçš„ review æ–‡ä»¶åŒ…å« `target_week` å­—æ®µã€‚

### 2. äº¤äº’å¼è¾“å…¥åœ¨æŸäº›ç»ˆç«¯å¯èƒ½ä¸å…¼å®¹

readline åœ¨æŸäº›ç¯å¢ƒä¸‹å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**: å¦‚æœé‡åˆ°é—®é¢˜ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„å•æ–‡ä»¶æ¨¡å¼ã€‚

---

## ğŸš€ åç»­æ”¹è¿›

### çŸ­æœŸ (1-2å‘¨)

1. **ä¼˜åŒ–å»é‡ç®—æ³•**:
   - è€ƒè™‘æ´»åŠ¨æ—¶é—´ç›¸ä¼¼åº¦
   - æ”¯æŒæ‰‹åŠ¨ç¡®è®¤å»é‡ç»“æœ

2. **æ”¹è¿›äº¤äº’ç•Œé¢**:
   - æ”¯æŒå¤šé€‰ï¼ˆåŒæ—¶é€‰æ‹©å¤šä¸ªæ—¶é—´æ®µï¼‰
   - æ˜¾ç¤ºæ›´å¤špreviewä¿¡æ¯

### ä¸­æœŸ (1-2æœˆ)

3. **æ™ºèƒ½æ¨è**:
   - åŸºäºå†å²æ•°æ®ï¼Œæ¨èæœ€ä½³çš„reviewç»„åˆ
   - é¢„æµ‹åˆå¹¶åçš„æ´»åŠ¨è´¨é‡

4. **å¯è§†åŒ–dashboard**:
   - æ˜¾ç¤ºå„ä¸ªæ¥æºç½‘ç«™çš„è´¡çŒ®åº¦
   - æ˜¾ç¤ºå»é‡ç»Ÿè®¡å›¾è¡¨

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [FEEDBACK_LOOP_DESIGN.md](./FEEDBACK_LOOP_DESIGN.md) - æ•´ä½“è®¾è®¡
- [FEEDBACK_LOOP_USAGE.md](./FEEDBACK_LOOP_USAGE.md) - ä½¿ç”¨æŒ‡å— (å·²æ›´æ–°)
- [SPRINT1_SUMMARY.md](./SPRINT1_SUMMARY.md) - Sprint 1 æ€»ç»“

---

## ğŸ“ å˜æ›´æ—¥å¿—

### v1.5.0 - 2025-11-04

**æ–°å¢**:
- å¤šreviewæ–‡ä»¶åˆå¹¶åŠŸèƒ½
- äº¤äº’å¼é€‰æ‹©ç•Œé¢
- æ´»åŠ¨å»é‡ç®—æ³• (80% title + åœ°ç‚¹)
- æ¥æºè¿½è¸ªç³»ç»Ÿ

**æ•°æ®åº“**:
- posts è¡¨æ–°å¢ 2 ä¸ªå­—æ®µ
- event_performance è¡¨æ–°å¢ 2 ä¸ªå­—æ®µ
- schema_version æ›´æ–°åˆ° v1.5.0

**æ–‡ä»¶**:
- æ–°å¢ `src/utils/review-merger.js`
- æ–°å¢ `src/feedback/schema-v1.5.sql`
- ä¿®æ”¹ `src/feedback/performance-database.js`
- ä¿®æ”¹ `src/generate-post.js`

---

**å®Œæˆæ—¶é—´**: 2025-11-04
**é¢„ä¼°å·¥æ—¶**: 3-4 å°æ—¶
**å®é™…å·¥æ—¶**: çº¦ 3.5 å°æ—¶
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼Œå¾…ç”¨æˆ·éªŒè¯
