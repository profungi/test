# æµ‹è¯•å®Œæ•´æŒ‡å—æ€»ç»“

> å¦‚ä½•æµ‹è¯•æŠ“å–æ•ˆç‡ä¼˜åŒ–ä»£ç  â€” å®Œæ•´çš„ä¸‰å±‚æµ‹è¯•æ–¹æ¡ˆ

## ğŸ¯ ä¸‰å±‚æµ‹è¯•æ–¹æ¡ˆ

### ç¬¬ä¸€å±‚ï¼šå¿«é€ŸéªŒè¯ (30 ç§’ - 5 åˆ†é’Ÿ)

**ç”¨é€”**ï¼šç¡®è®¤ä»£ç ä¿®æ”¹æ˜¯å¦å­˜åœ¨ä¸”æ­£ç¡®

**è¿è¡Œæ–¹å¼**ï¼š
```bash
node quick-test.js
```

**æ£€æŸ¥å†…å®¹**ï¼š
- âœ… 5 ä¸ªæ•°æ®åº“ç´¢å¼•æ˜¯å¦åœ¨ä»£ç ä¸­
- âœ… å…³é”®è¯æœç´¢é˜ˆå€¼å¸¸é‡æ˜¯å¦å­˜åœ¨
- âœ… æ¡ä»¶åˆ¤æ–­é€»è¾‘æ˜¯å¦æ­£ç¡®

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… ä¼˜åŒ–ä»£ç éªŒè¯é€šè¿‡ï¼
   - æ•°æ®åº“ç´¢å¼•å·²å…¨éƒ¨å®ç°
   - å…³é”®è¯æœç´¢é˜ˆå€¼å·²å®ç°
```

**æˆåŠŸæ ‡å‡†**ï¼šå…¨éƒ¨æ˜¾ç¤º âœ…

---

### ç¬¬äºŒå±‚ï¼šå®Œæ•´è‡ªåŠ¨åŒ–æµ‹è¯• (20 åˆ†é’Ÿ)

**ç”¨é€”**ï¼šå…¨é¢æµ‹è¯•ä¼˜åŒ–åŠŸèƒ½çš„æ­£ç¡®æ€§å’Œæ€§èƒ½

**è¿è¡Œæ–¹å¼**ï¼š
```bash
node test-optimizations.js              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
node test-optimizations.js --db-only    # ä»…æ•°æ®åº“
node test-optimizations.js --keyword    # ä»…å…³é”®è¯æœç´¢
```

**åŒ…æ‹¬çš„æµ‹è¯•**ï¼š

1. **æ•°æ®åº“ç´¢å¼•æµ‹è¯•**
   - ç´¢å¼•æ˜¯å¦æ­£ç¡®åˆ›å»º
   - æŸ¥è¯¢æ€§èƒ½æ˜¯å¦æå‡
   - é‡å¤åˆ›å»ºæ˜¯å¦å®‰å…¨

2. **å…³é”®è¯æœç´¢æµ‹è¯•**
   - é˜ˆå€¼æ˜¯å¦æ­£ç¡®è®¾ç½®
   - æ¡ä»¶åˆ¤æ–­æ˜¯å¦æœ‰æ•ˆ
   - æ—¥å¿—è¾“å‡ºæ˜¯å¦æ­£ç¡®

3. **å¥å£®æ€§æµ‹è¯•**
   - å¤šæ¬¡è¿è¡Œæ˜¯å¦å´©æºƒ
   - é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„
   - æ—§æ•°æ®åº“æ˜¯å¦è‡ªåŠ¨å‡çº§

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ“Š æµ‹è¯•æ€»ç»“
é€šè¿‡: 8/8 (100%)

âœ… æ•°æ®åº“ç´¢å¼•å­˜åœ¨æ€§
âœ… å…³é”®è¯æœç´¢é€»è¾‘
âœ… æŸ¥è¯¢æ€§èƒ½ (å¸¦ç´¢å¼•) - 45ms
âœ… ç´¢å¼•åˆ›å»ºå¥å£®æ€§
âœ… å…³é”®è¯é˜ˆå€¼è¡Œä¸º

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä¼˜åŒ–å·²æˆåŠŸå®æ–½
```

**æˆåŠŸæ ‡å‡†**ï¼šæ‰€æœ‰æµ‹è¯•é€šè¿‡ (100%)

---

### ç¬¬ä¸‰å±‚ï¼šæ‰‹åŠ¨åŠŸèƒ½æµ‹è¯• (1 å°æ—¶+)

**ç”¨é€”**ï¼šåœ¨å®é™…ä½¿ç”¨åœºæ™¯ä¸­éªŒè¯ä¼˜åŒ–æ•ˆæœ

#### æµ‹è¯• 3.1: å®é™…æŠ“å–éªŒè¯

```bash
# æ¸…ç©ºæ•°æ®åº“
npm run clear-events

# è¿è¡ŒæŠ“å–ï¼Œè®°å½•è€—æ—¶
time npm run scrape
```

**æ£€æŸ¥ç‚¹**ï¼š
- [ ] æŠ“å–å®Œæˆï¼Œæ— é”™è¯¯
- [ ] æ—¥å¿—æ˜¾ç¤ºç´¢å¼•å·²åˆ›å»º
- [ ] å…³é”®è¯æœç´¢è¢«è·³è¿‡ï¼ˆå¦‚æœäº‹ä»¶ >= 50ï¼‰
- [ ] ç”Ÿæˆçš„å®¡æ ¸æ–‡ä»¶æ­£ç¡®
- [ ] è€—æ—¶å‡å°‘äº† 10-18%

#### æµ‹è¯• 3.2: æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

```bash
sqlite3 data/events.db

# åœ¨ SQLite å‘½ä»¤è¡Œä¸­ï¼š
.timer on

SELECT title FROM events
WHERE week_identifier = '2024-10-21_to_2024-10-27'
AND location = 'San Francisco'
LIMIT 10;
```

**é¢„æœŸ**ï¼š
- è€—æ—¶ < 50msï¼ˆæœ‰ç´¢å¼•ï¼‰
- æ˜¾ç¤º "SEARCH events USING INDEX idx_events_dedup"

#### æµ‹è¯• 3.3: å…³é”®è¯æœç´¢é€»è¾‘

**åœºæ™¯ 1**ï¼šäº‹ä»¶æ•° < 50ï¼ˆåº”è¯¥æ‰§è¡Œæœç´¢ï¼‰

```bash
# ä¿®æ”¹é˜ˆå€¼ä¸´æ—¶è°ƒä½ä»¥æµ‹è¯•
const keywordSearchThreshold = 10;

npm run scrape

# åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š
# "Scraping additional searches: festival, fair, ..."
```

**åœºæ™¯ 2**ï¼šäº‹ä»¶æ•° >= 50ï¼ˆåº”è¯¥è·³è¿‡æœç´¢ï¼‰

```bash
# æ¢å¤æˆ–ä¿æŒæ­£å¸¸é˜ˆå€¼
const keywordSearchThreshold = 50;

npm run scrape

# åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼š
# "â­ï¸ Skipping keyword searches (already have XX events"
```

#### æµ‹è¯• 3.4: æ•°æ®å®Œæ•´æ€§

```bash
# éªŒè¯å»é‡ä»ç„¶å·¥ä½œæ­£å¸¸
node -e "
const db = require('./src/utils/database');
const d = new db();
d.connect().then(async () => {
  const event = { title: 'Test', startTime: '2024-10-21T10:00:00', location: 'SF', originalUrl: 'http://test.com', source: 'test', weekIdentifier: '2024-10-21_to_2024-10-27' };
  const r1 = await d.saveEvent(event);
  const r2 = await d.saveEvent(event);
  console.log('First save:', r1.saved ? 'âœ… Saved' : 'âŒ Duplicate');
  console.log('Second save:', !r2.saved ? 'âœ… Duplicate detected' : 'âŒ Should be duplicate');
  await d.close();
});
"
```

**é¢„æœŸè¾“å‡º**ï¼š
```
First save: âœ… Saved
Second save: âœ… Duplicate detected
```

---

## ğŸ“š æ–‡æ¡£æ€»è§ˆ

ä½ ç°åœ¨æ‹¥æœ‰å®Œæ•´çš„æµ‹è¯•æ–‡æ¡£å¥—ä»¶ï¼š

| æ–‡ä»¶ | ç”¨é€” | æ—¶é—´ |
|------|------|------|
| `quick-test.js` | è‡ªåŠ¨åŒ–å¿«é€Ÿæ£€æŸ¥ | 30ç§’ |
| `test-optimizations.js` | å®Œæ•´è‡ªåŠ¨åŒ–æµ‹è¯• | 20åˆ†é’Ÿ |
| `TESTING_CHEATSHEET.md` | é€ŸæŸ¥è¡¨ï¼ˆæ¨èé¦–å…ˆé˜…è¯»ï¼‰| 5åˆ†é’Ÿ |
| `TEST_GUIDE.md` | è¯¦ç»†æµ‹è¯•æŒ‡å— | å‚è€ƒ |
| `SCRAPING_OPTIMIZATION.md` | ä¼˜åŒ–æ–¹æ¡ˆæ–‡æ¡£ | å‚è€ƒ |
| `TESTING_SUMMARY.md` | è¿™ä¸ªæ–‡ä»¶ | æ¦‚è§ˆ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èé¡ºåºï¼‰

### ç¬¬ä¸€æ¬¡æµ‹è¯•ï¼ˆæ¨èç”¨æ—¶ï¼š30 åˆ†é’Ÿï¼‰

```bash
# 1. å¿«é€ŸéªŒè¯ (30ç§’)
node quick-test.js

# 2. å¦‚æœé€šè¿‡ï¼Œè¿è¡Œå®Œæ•´æµ‹è¯• (20åˆ†é’Ÿ)
node test-optimizations.js

# 3. æŸ¥çœ‹è¯¦ç»†æŒ‡å—
cat TESTING_CHEATSHEET.md
```

### æ—¥å¸¸éªŒè¯ï¼ˆæ¨èç”¨æ—¶ï¼š5 åˆ†é’Ÿï¼‰

```bash
# ä»…å¿«é€Ÿæ£€æŸ¥ä»£ç 
node quick-test.js

# æˆ–è€…è¿è¡Œå®é™…æŠ“å–
npm run scrape
```

### è¯¦ç»†æµ‹è¯•ï¼ˆæ¨èç”¨æ—¶ï¼š1 å°æ—¶ï¼‰

```bash
# å‚è€ƒè¯¦ç»†æŒ‡å—
cat TEST_GUIDE.md

# æŒ‰æ­¥éª¤è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### çº§åˆ« 1ï¼šå¿«é€ŸéªŒè¯ âœ… (å¿…é¡»é€šè¿‡)

- [ ] `node quick-test.js` æ˜¾ç¤ºæ‰€æœ‰ âœ…
- [ ] 5 ä¸ªæ•°æ®åº“ç´¢å¼•ä»£ç å­˜åœ¨
- [ ] å…³é”®è¯æœç´¢é˜ˆå€¼ä»£ç å­˜åœ¨

### çº§åˆ« 2ï¼šå®Œæ•´æµ‹è¯• âœ… (å¼ºçƒˆå»ºè®®é€šè¿‡)

- [ ] `node test-optimizations.js` 100% é€šè¿‡
- [ ] æ•°æ®åº“ç´¢å¼•æµ‹è¯•é€šè¿‡
- [ ] å…³é”®è¯æœç´¢é€»è¾‘æµ‹è¯•é€šè¿‡
- [ ] å¥å£®æ€§æµ‹è¯•é€šè¿‡

### çº§åˆ« 3ï¼šå®é™…éªŒè¯ âœ… (ç”Ÿäº§ç¯å¢ƒå‰å¿…é¡»é€šè¿‡)

- [ ] `npm run scrape` æ­£å¸¸å®Œæˆ
- [ ] æ—¥å¿—è¾“å‡ºæ­£ç¡®
- [ ] ç”Ÿæˆæ–‡ä»¶æœ‰æ•ˆ
- [ ] è€—æ—¶å‡å°‘ 10-18%
- [ ] æ— æ–°å¢é”™è¯¯

---

## ğŸ” å…³é”®æµ‹è¯•ç‚¹

### æ•°æ®åº“ç´¢å¼•éªŒè¯

```bash
# éªŒè¯ç´¢å¼•å­˜åœ¨
sqlite3 data/events.db ".indices"

# éªŒè¯ç´¢å¼•è¢«ä½¿ç”¨
sqlite3 data/events.db
EXPLAIN QUERY PLAN SELECT * FROM events
WHERE week_identifier = '2024-10-21_to_2024-10-27'
AND location = 'San Francisco';

# éªŒè¯æŸ¥è¯¢æ€§èƒ½
.timer on
SELECT COUNT(*) FROM events WHERE week_identifier = '2024-10-21_to_2024-10-27';
```

### å…³é”®è¯æœç´¢éªŒè¯

```bash
# æ£€æŸ¥ä»£ç 
grep -n "keywordSearchThreshold" src/scrapers/eventbrite-scraper.js

# éªŒè¯é€»è¾‘
grep -A 3 "events.length < keywordSearchThreshold" src/scrapers/eventbrite-scraper.js

# å®é™…è¿è¡Œè§‚å¯Ÿæ—¥å¿—
npm run scrape 2>&1 | grep -i "keyword\|skipping"
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥å¿«é€ŸæŒ‡å—

| ç—‡çŠ¶ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| `quick-test.js` å¤±è´¥ | ä»£ç ä¿®æ”¹æœ‰é—®é¢˜ | æ£€æŸ¥ src/utils/database.js å’Œ eventbrite-scraper.js |
| `test-optimizations.js` å¤±è´¥ | æµ‹è¯•ç¯å¢ƒé—®é¢˜ | è¿è¡Œ `npm install` å¹¶æ¸…ç©º data/events.db |
| SQLite æŸ¥è¯¢æ…¢ | ç´¢å¼•æœªè¢«ä½¿ç”¨ | æ£€æŸ¥ EXPLAIN QUERY PLAN è¾“å‡º |
| å…³é”®è¯æœç´¢ä»åœ¨ç»§ç»­ | é˜ˆå€¼è®¾ç½®é”™è¯¯ | æ£€æŸ¥æ˜¯å¦ä¿®æ”¹äº† keywordSearchThreshold å€¼ |
| æ•°æ®åº“æƒé™é”™è¯¯ | æ–‡ä»¶æƒé™é—®é¢˜ | è¿è¡Œ `rm -f data/events.db` é‡å»º |

---

## ğŸ“Š é¢„æœŸç»“æœ

### æ€§èƒ½æ”¹è¿›

```
ä¼˜åŒ–å‰: 12 åˆ†é’Ÿ
ä¼˜åŒ–å: 10-10.5 åˆ†é’Ÿ
æå‡: 10-18% â¬†ï¸
```

### æ—¥å¿—è¾“å‡º

```
âœ… Database indexes created/verified      (æ•°æ®åº“)
ğŸ“Š Current events: 45/50 (threshold)      (æ¥è¿‘é˜ˆå€¼)
âœ… Found 3 festival events                (æœç´¢ç»§ç»­)
â­ï¸ Skipping keyword searches               (å·²è¾¾é˜ˆå€¼ï¼Œè·³è¿‡)
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### ä»£ç ä½ç½®

- **æ•°æ®åº“ä¼˜åŒ–**ï¼š`/code/src/utils/database.js:91-147`
- **å…³é”®è¯ä¼˜åŒ–**ï¼š`/code/src/scrapers/eventbrite-scraper.js:55-88`

### ç›¸å…³æ–‡æ¡£

- `SCRAPING_OPTIMIZATION.md` - ä¼˜åŒ–æ–¹æ¡ˆè¯¦è§£
- `TEST_GUIDE.md` - è¯¦ç»†æµ‹è¯•æŒ‡å—
- `TESTING_CHEATSHEET.md` - é€ŸæŸ¥è¡¨

---

## ğŸ’¡ å»ºè®®

1. **é¦–æ¬¡æµ‹è¯•**ï¼šæŒ‰ç…§ä¸Šè¿°"å¿«é€Ÿå¼€å§‹"é¡ºåºè¿›è¡Œ
2. **æ—¥å¸¸ä½¿ç”¨**ï¼šåªéœ€è¿è¡Œ `node quick-test.js` ç¡®è®¤
3. **éƒ¨ç½²å‰**ï¼šå¿…é¡»é€šè¿‡çº§åˆ« 2 çš„å®Œæ•´æµ‹è¯•
4. **é—®é¢˜æ’æŸ¥**ï¼šå‚è€ƒ"æ•…éšœæ’æŸ¥"è¡¨æ ¼å’Œ `TEST_GUIDE.md`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

1. **å¿«é€Ÿé—®é¢˜**ï¼šæŸ¥çœ‹ `TESTING_CHEATSHEET.md`
2. **è¯¦ç»†é—®é¢˜**ï¼šæŸ¥çœ‹ `TEST_GUIDE.md`
3. **ä¼˜åŒ–ç»†èŠ‚**ï¼šæŸ¥çœ‹ `SCRAPING_OPTIMIZATION.md`
4. **ä»£ç é—®é¢˜**ï¼šæ£€æŸ¥æºæ–‡ä»¶ä¸­çš„æ³¨é‡Š

---

**ç‰ˆæœ¬**ï¼š1.0
**æ›´æ–°æ—¥æœŸ**ï¼š2024-10-22
**ç»´æŠ¤è€…**ï¼šClaude Code

---

**ä¸‹ä¸€æ­¥**ï¼šè¿è¡Œ `node quick-test.js` å¼€å§‹æµ‹è¯•ï¼ ğŸš€
