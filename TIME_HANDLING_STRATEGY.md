# 时间处理策略文档

## 核心原则
1. **精准优先**：只接受有明确小时和分钟的时间，拒绝纯日期
2. **精确到分钟**：统一格式 `YYYY-MM-DDTHH:MM`（去除秒）
3. **时区正确性**：确保所有时间都是PST/PDT本地时间

## 三个网站的时间处理策略

### 1. Eventbrite

**时间来源：**
- `<time datetime="2025-10-26T19:00:00-07:00">` 标签
- 时间文本：`"Sunday, October 26 · 7 - 10pm PDT"`

**时区情况：**
- ✅ 总是包含时区信息：`-07:00` (PDT) 或 `-08:00` (PST)
- ✅ datetime属性中的时间已经是本地时间

**处理策略：**
```javascript
输入: "2025-10-26T19:00:00-07:00"
步骤:
1. 验证时区：检查是否为 -07:00 或 -08:00（旧金山时区）
2. 提取时间：去除时区后缀 → "2025-10-26T19:00:00"
3. 去除秒：→ "2025-10-26T19:00"
4. 验证：必须包含T和时间部分，否则返回null

输入: "2025-10-26" (仅日期)
处理: 返回 null（跳过该活动）
原因: Eventbrite质量高，没有时间说明数据有问题
```

### 2. SFStation

**时间来源：**
- `[itemprop="startDate"]` 属性
- 常见格式：`"2025-10-06T18:00:00-07:00"`

**时区情况：**
- ✅ 通常包含时区信息
- ⚠️ 有时仅给出日期

**处理策略：**
```javascript
输入: "2025-10-06T18:00:00-07:00"
步骤:
1. 去除时区：→ "2025-10-06T18:00:00"
2. 去除秒：→ "2025-10-06T18:00"
3. 验证格式

输入: "2025-10-26" (仅日期)
步骤:
1. 尝试从页面文本中提取时间（如 .event-time）
2. 如果找到文本时间（如 "7:00 PM"）→ 解析并合并
3. 如果找不到 → 返回 null（跳过该活动）
```

### 3. DoTheBay

**时间来源：**
- `<time datetime="...">` 或 `[itemprop="startDate"]`
- 常见格式：`"2025-10-15T10:00:00-07:00"`

**时区情况：**
- ✅ 通常包含时区信息
- ⚠️ 有时仅给出日期（特别是全天活动如市集）

**处理策略：**
```javascript
输入: "2025-10-15T10:00:00-07:00"
步骤:
1. 去除时区：→ "2025-10-15T10:00:00"
2. 去除秒：→ "2025-10-15T10:00"

输入: "2025-10-26" (仅日期)
步骤:
1. 尝试从<time>标签的文本内容提取（如 "10am - 2pm"）
2. 如果找到 → 解析并使用开始时间
3. 如果找不到 → 返回 null（跳过该活动）

注意：DoTheBay很多市集活动，但如果网页给了具体时间就必须有
```

## 统一时间格式

**输出格式：** `YYYY-MM-DDTHH:MM`

**示例：**
- ✅ `"2025-10-26T19:00"`
- ✅ `"2025-10-26T08:30"`
- ❌ `"2025-10-26T19:00:00"` (有秒)
- ❌ `"2025-10-26"` (无时间)
- ❌ `"2025-10-26T12:00"` (默认时间)

## 时区验证规则

旧金山时区：
- **PST** (太平洋标准时间): UTC-08:00 (11月-3月)
- **PDT** (太平洋夏令时): UTC-07:00 (3月-11月)

**验证逻辑：**
```javascript
// 如果时间字符串包含时区，验证是否为旧金山时区
if (timeStr.includes('-08:00') || timeStr.includes('-07:00')) {
  // ✅ 正确的旧金山时区
} else if (timeStr.includes('Z') || timeStr.match(/[+-]\d{2}:\d{2}$/)) {
  // ⚠️ 其他时区，需要转换或警告
  console.warn(`Unexpected timezone: ${timeStr}`);
}
```

## 错误处理

**日志级别：**
- `console.log`: 正常跳过（如仅有日期）
- `console.warn`: 异常格式（如非PST/PDT时区）
- `console.error`: 解析失败

**统计跟踪：**
```javascript
stats = {
  total: 100,
  withTime: 85,        // 有完整时间
  dateOnly: 10,        // 仅日期（跳过）
  parsedFromText: 3,   // 从文本解析
  invalid: 2           // 格式错误（跳过）
}
```
