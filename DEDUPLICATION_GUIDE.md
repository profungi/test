# å»é‡åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`remove-duplicates-turso.js` æ˜¯ä¸€ä¸ªæ™ºèƒ½å»é‡è„šæœ¬ï¼Œæ”¯æŒè‡ªåŠ¨æ£€æµ‹å’Œåˆ é™¤æ•°æ®åº“ä¸­çš„é‡å¤æ´»åŠ¨ã€‚

### ä¸»è¦ç‰¹æ€§

âœ… **æ”¯æŒåŒæ•°æ®åº“**: è‡ªåŠ¨æ£€æµ‹ `USE_TURSO` ç¯å¢ƒå˜é‡ï¼Œæ”¯æŒ Turso å’Œæœ¬åœ° SQLite
âœ… **æ”¹è¿›çš„å»é‡é€»è¾‘**: é»˜è®¤ä½¿ç”¨ `original_url` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆæ¯”æ ‡é¢˜æ›´å‡†ç¡®ï¼‰
âœ… **é¢„è§ˆæ¨¡å¼**: å®‰å…¨æŸ¥çœ‹å°†è¦åˆ é™¤çš„æ•°æ®ï¼Œä¸å®é™…åˆ é™¤
âœ… **æ™ºèƒ½ä¿ç•™**: ä¼˜å…ˆä¿ç•™ä¼˜å…ˆçº§æœ€é«˜æˆ–æœ€æ–°æŠ“å–çš„æ´»åŠ¨
âœ… **æ— æ•ˆæ´»åŠ¨æ¸…ç†**: è‡ªåŠ¨åˆ é™¤æ ‡é¢˜æ˜¯åŸŸåçš„æ— æ•ˆæ´»åŠ¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# é¢„è§ˆæ¨¡å¼ï¼ˆæ¨èç¬¬ä¸€æ¬¡è¿è¡Œï¼‰
npm run remove-duplicates-preview

# å®é™…åˆ é™¤é‡å¤
npm run remove-duplicates

# ä½¿ç”¨æ ‡é¢˜å»é‡ï¼ˆå…¼å®¹æ—§é€»è¾‘ï¼‰
npm run remove-duplicates-by-title
```

### ç¯å¢ƒå˜é‡æ§åˆ¶

```bash
# å»é‡æœ¬åœ°æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰
npm run remove-duplicates

# å»é‡ Turso æ•°æ®åº“
USE_TURSO=1 npm run remove-duplicates

# æˆ–è€…åœ¨ .env ä¸­è®¾ç½®
USE_TURSO=1
TURSO_DATABASE_URL=libsql://your-db.turso.io
TURSO_AUTH_TOKEN=your_token
```

## ğŸ“Š å»é‡é€»è¾‘

### 1. åˆ é™¤æ— æ•ˆæ´»åŠ¨

è‡ªåŠ¨åˆ é™¤è¿™äº›æ— æ•ˆæ ‡é¢˜çš„æ´»åŠ¨ï¼š
- `www.sfstation.com`
- `www sfstation com`
- `eventbrite.com`
- `funcheap.com`

### 2. æŸ¥æ‰¾é‡å¤æ´»åŠ¨

**é»˜è®¤æ–¹å¼**ï¼ˆæŒ‰ `original_url`ï¼‰ï¼š
```bash
npm run remove-duplicates
```

**å…¼å®¹æ–¹å¼**ï¼ˆæŒ‰ `normalized_title`ï¼‰ï¼š
```bash
npm run remove-duplicates-by-title
```

### 3. ä¿ç•™ç­–ç•¥

å¯¹äºæ¯ç»„é‡å¤æ´»åŠ¨ï¼š
1. **ä¼˜å…ˆçº§æœ€é«˜**: ä¿ç•™ `priority` å­—æ®µå€¼æœ€å¤§çš„
2. **æ—¶é—´æœ€æ–°**: å¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œä¿ç•™ `scraped_at` æœ€æ–°çš„
3. **åˆ é™¤å…¶ä»–**: åˆ é™¤å‰©ä½™çš„é‡å¤é¡¹

### ä¸ºä»€ä¹ˆä½¿ç”¨ original_urlï¼Ÿ

| ç‰¹æ€§ | original_url | normalized_title |
|------|-------------|------------------|
| **å‡†ç¡®æ€§** | âœ… 100% å‡†ç¡® | âš ï¸ å¯èƒ½è¯¯åˆ¤ |
| **å”¯ä¸€æ€§** | âœ… URL å”¯ä¸€ | âŒ æ ‡é¢˜å¯èƒ½ç›¸åŒ |
| **ç¨³å®šæ€§** | âœ… URL ä¸å˜ | âš ï¸ æ ‡é¢˜å¯èƒ½å˜åŒ– |
| **æ¨è** | âœ… é»˜è®¤ä½¿ç”¨ | âš ï¸ ç‰¹æ®Šæƒ…å†µä½¿ç”¨ |

**ç¤ºä¾‹é—®é¢˜**ï¼ˆä½¿ç”¨ normalized_titleï¼‰ï¼š
```
æ´»åŠ¨ A: "Holiday Market"
æ´»åŠ¨ B: "Holiday Market" ï¼ˆä¸åŒåœ°ç‚¹ï¼Œä¸åŒ URLï¼‰
â†’ è¯¯åˆ¤ä¸ºé‡å¤ï¼
```

**æ­£ç¡®å¤„ç†**ï¼ˆä½¿ç”¨ original_urlï¼‰ï¼š
```
æ´»åŠ¨ A: URL = https://eventbrite.com/event/123
æ´»åŠ¨ B: URL = https://eventbrite.com/event/456
â†’ æ­£ç¡®è¯†åˆ«ä¸ºä¸åŒæ´»åŠ¨
```

## ğŸ’» å‘½ä»¤è¡Œé€‰é¡¹

### npm è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åˆ é™¤é‡å¤ï¼ˆè‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ï¼‰
npm run remove-duplicates

# é¢„è§ˆæ¨¡å¼
npm run remove-duplicates-preview

# ä½¿ç”¨æ ‡é¢˜å»é‡
npm run remove-duplicates-by-title
```

### ç›´æ¥è°ƒç”¨

```bash
# æ˜¾ç¤ºå¸®åŠ©
node remove-duplicates-turso.js --help

# é¢„è§ˆæ¨¡å¼
node remove-duplicates-turso.js --dry-run

# ä½¿ç”¨ normalized_title å»é‡
node remove-duplicates-turso.js --dedupe-by=normalized_title

# å»é‡ Turso æ•°æ®åº“
USE_TURSO=1 node remove-duplicates-turso.js
```

## ğŸ“ˆ è¾“å‡ºç¤ºä¾‹

### æˆåŠŸè¿è¡Œ

```
ğŸ’¾ ä½¿ç”¨æœ¬åœ°æ•°æ®åº“

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” æŸ¥æ‰¾å¹¶åˆ é™¤é‡å¤æ´»åŠ¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ å»é‡é…ç½®:
   æ•°æ®åº“: Local SQLite
   å»é‡ä¾æ®: original_url
   é¢„è§ˆæ¨¡å¼: å¦

ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 520

ğŸ—‘ï¸  åˆ é™¤æ— æ•ˆæ´»åŠ¨...
   âœ… åˆ é™¤äº† 3 ä¸ªæ— æ•ˆæ´»åŠ¨

ğŸ” æŸ¥æ‰¾é‡å¤æ´»åŠ¨ï¼ˆæŒ‰ original_url åˆ†ç»„ï¼‰...

   å‘ç° 8 ç»„é‡å¤æ´»åŠ¨

ğŸ“‹ é‡å¤æ´»åŠ¨é¢„è§ˆ:
   1. "SF Holiday Market at Union Square"
      URL: https://sfstation.com/event/123
      é‡å¤æ•°: 2
      IDs: 45, 87
      ä¼˜å…ˆçº§: 5, 3

   2. "Ice Skating at Embarcadero"
      URL: https://funcheap.com/event/456
      é‡å¤æ•°: 3
      IDs: 102, 125, 156
      ä¼˜å…ˆçº§: 10, 10, 5

   ... è¿˜æœ‰ 6 ç»„é‡å¤

ğŸ—‘ï¸  åˆ é™¤é‡å¤æ´»åŠ¨ï¼ˆä¿ç•™ä¼˜å…ˆçº§æœ€é«˜æˆ–æœ€æ–°æŠ“å–çš„ï¼‰...

   âœ… åˆ é™¤äº† 12 ä¸ªé‡å¤æ´»åŠ¨

âœ… å»é‡å®Œæˆï¼

ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
   â€¢ åˆå§‹æ´»åŠ¨æ•°: 520
   â€¢ åˆ é™¤æ— æ•ˆæ´»åŠ¨: 3
   â€¢ åˆ é™¤é‡å¤æ´»åŠ¨: 12
   â€¢ æœ€ç»ˆæ´»åŠ¨æ•°: 505
   â€¢ å…±åˆ é™¤: 15

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### é¢„è§ˆæ¨¡å¼ï¼ˆ--dry-runï¼‰

```
ğŸ“‹ å»é‡é…ç½®:
   é¢„è§ˆæ¨¡å¼: æ˜¯ï¼ˆä¸ä¼šå®é™…åˆ é™¤ï¼‰

ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 520

ğŸ” æ£€æŸ¥æ— æ•ˆæ´»åŠ¨...
   å‘ç° 3 ä¸ªæ— æ•ˆæ´»åŠ¨ï¼ˆé¢„è§ˆæ¨¡å¼ï¼Œæœªåˆ é™¤ï¼‰

ğŸ” æŸ¥æ‰¾é‡å¤æ´»åŠ¨ï¼ˆæŒ‰ original_url åˆ†ç»„ï¼‰...

   å‘ç° 8 ç»„é‡å¤æ´»åŠ¨

ğŸ“‹ é‡å¤æ´»åŠ¨é¢„è§ˆ:
   [æ˜¾ç¤ºé‡å¤æ´»åŠ¨åˆ—è¡¨]

ğŸ” é¢„è§ˆæ¨¡å¼ - æœªå®é™…åˆ é™¤æ•°æ®
```

### æ— é‡å¤

```
ğŸ“Š åˆå§‹æ´»åŠ¨æ•°: 480

ğŸ” æ£€æŸ¥æ— æ•ˆæ´»åŠ¨...
   å‘ç° 0 ä¸ªæ— æ•ˆæ´»åŠ¨

ğŸ” æŸ¥æ‰¾é‡å¤æ´»åŠ¨ï¼ˆæŒ‰ original_url åˆ†ç»„ï¼‰...

   å‘ç° 0 ç»„é‡å¤æ´»åŠ¨

âœ… æ²¡æœ‰å‘ç°é‡å¤æ´»åŠ¨ï¼
```

## ğŸ” å¸¸è§åœºæ™¯

### åœºæ™¯ 1: æ¯å‘¨ Scrape åå»é‡

```bash
# 1. æŠ“å–æ´»åŠ¨
npm run scrape

# 2. é¢„è§ˆé‡å¤æƒ…å†µ
npm run remove-duplicates-preview

# 3. ç¡®è®¤ååˆ é™¤
npm run remove-duplicates

# 4. ç¿»è¯‘ç¼ºå¤±æ ‡é¢˜
npm run translate-missing
```

### åœºæ™¯ 2: Turso æ•°æ®åº“å»é‡

```bash
# 1. ç¡®è®¤ç¯å¢ƒå˜é‡
grep USE_TURSO .env

# 2. é¢„è§ˆ Turso çš„é‡å¤
USE_TURSO=1 npm run remove-duplicates-preview

# 3. åˆ é™¤ Turso çš„é‡å¤
USE_TURSO=1 npm run remove-duplicates

# 4. åŒæ­¥åˆ°æœ¬åœ°
npm run sync-from-turso

# 5. æœ¬åœ°ä¹Ÿå»é‡ï¼ˆä¿æŒä¸€è‡´ï¼‰
USE_TURSO=0 npm run remove-duplicates
```

### åœºæ™¯ 3: ä¿®å¤å†å²æ•°æ®

å¦‚æœæ ‡é¢˜è§„èŒƒåŒ–æœ‰é—®é¢˜ï¼Œå¯¼è‡´è¯¯åˆ¤ï¼š

```bash
# ä½¿ç”¨ original_url é‡æ–°å»é‡
npm run remove-duplicates

# å¦‚æœéœ€è¦æ›´æ¿€è¿›çš„å»é‡
npm run remove-duplicates-by-title
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸å¯æ¢å¤

```bash
# âŒ é”™è¯¯ï¼šç›´æ¥åˆ é™¤
npm run remove-duplicates

# âœ… æ­£ç¡®ï¼šå…ˆé¢„è§ˆ
npm run remove-duplicates-preview
# ç¡®è®¤æ— è¯¯åå†è¿è¡Œ
npm run remove-duplicates
```

### 2. Turso å’Œæœ¬åœ°åŒæ­¥

```bash
# å»ºè®®æµç¨‹
USE_TURSO=1 npm run remove-duplicates  # Turso å»é‡
npm run sync-from-turso                 # åŒæ­¥åˆ°æœ¬åœ°
```

**ä¸æ¨è**ï¼šæœ¬åœ°å»é‡åå†åŒæ­¥ï¼ˆä¼šè¢« Turso çš„é‡å¤æ•°æ®è¦†ç›–ï¼‰

### 3. é…ç½®æ£€æŸ¥

å¦‚æœçœ‹åˆ°è­¦å‘Šï¼š
```
âš ï¸  è­¦å‘Š: TURSO é…ç½®æ— æ•ˆæˆ–æ˜¯å ä½ç¬¦
   å›é€€åˆ°æœ¬åœ°æ•°æ®åº“
```

æ£€æŸ¥ `.env` æ–‡ä»¶ï¼š
```bash
# ç¡®ä¿é…ç½®æœ‰æ•ˆ
TURSO_DATABASE_URL=libsql://your-real-url.turso.io
TURSO_AUTH_TOKEN=eyJhbG... # çœŸå® token
```

### 4. ä¿ç•™ä¼˜å…ˆçº§é€»è¾‘

å½“æœ‰å¤šä¸ªé‡å¤æ—¶ï¼Œè„šæœ¬ä¼šï¼š
1. æ¯”è¾ƒ `priority` å­—æ®µ
2. å¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œæ¯”è¾ƒ `scraped_at` æ—¶é—´
3. ä¿ç•™"æœ€å¥½"çš„ä¸€ä¸ªï¼Œåˆ é™¤å…¶ä»–

**ç¤ºä¾‹**ï¼š
```
æ´»åŠ¨ A: priority=10, scraped_at=2025-12-01
æ´»åŠ¨ B: priority=10, scraped_at=2025-12-10  â† ä¿ç•™è¿™ä¸ª
æ´»åŠ¨ C: priority=5,  scraped_at=2025-12-15
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: è„šæœ¬æ‰¾ä¸åˆ°é‡å¤

**å¯èƒ½åŸå› **ï¼š
- ä½¿ç”¨äº†é”™è¯¯çš„å»é‡å­—æ®µ
- æ•°æ®åº“ç¡®å®æ²¡æœ‰é‡å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å°è¯•ä¸åŒçš„å»é‡æ–¹å¼
npm run remove-duplicates-by-title
```

### é—®é¢˜ 2: åˆ é™¤äº†ä¸è¯¥åˆ é™¤çš„

**é¢„é˜²æªæ–½**ï¼š
```bash
# å§‹ç»ˆå…ˆè¿è¡Œé¢„è§ˆ
npm run remove-duplicates-preview
```

**å¦‚æœå·²åˆ é™¤**ï¼š
```bash
# ä» Turso é‡æ–°åŒæ­¥
npm run sync-full
```

### é—®é¢˜ 3: Turso è¿æ¥å¤±è´¥

**æ£€æŸ¥**ï¼š
```bash
# æµ‹è¯• Turso é…ç½®
npm run check-db
```

**å›é€€**ï¼š
```bash
# ä¸´æ—¶ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
USE_TURSO=0 npm run remove-duplicates
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå…¥é—¨](./QUICK_START.md) - åŸºæœ¬ä½¿ç”¨æŒ‡å—
- [åŒæ­¥è°ƒæŸ¥æŠ¥å‘Š](./SYNC_INVESTIGATION_REPORT.md) - æŠ€æœ¯ç»†èŠ‚
- [æ•°æ®æ¶æ„](./docs/DATA_ARCHITECTURE.md) - æ•°æ®åº“è®¾è®¡

## ğŸ¤” FAQ

### Q: ä»€ä¹ˆæ—¶å€™åº”è¯¥è¿è¡Œå»é‡ï¼Ÿ

**A**: å»ºè®®åœ¨ä»¥ä¸‹æ—¶æœºï¼š
- æ¯å‘¨ scrape ä¹‹å
- ä¿®å¤äº†æ•°æ®è´¨é‡é—®é¢˜å
- å‘ç°æœ‰é‡å¤æ´»åŠ¨æ—¶

### Q: å»é‡ä¼šå½±å“ feedback æ•°æ®å—ï¼Ÿ

**A**: ä¸ä¼šã€‚å»é‡åªæ“ä½œ `events` è¡¨ï¼Œä¸è§¦ç¢°ï¼š
- `posts`ï¼ˆå‘å¸ƒè®°å½•ï¼‰
- `event_performance`ï¼ˆæ´»åŠ¨è¡¨ç°ï¼‰
- `weight_adjustments`ï¼ˆæƒé‡è°ƒæ•´ï¼‰
- `user_feedback`ï¼ˆç”¨æˆ·åé¦ˆï¼‰

### Q: original_url å’Œ normalized_title å“ªä¸ªæ›´å¥½ï¼Ÿ

**A**:
- **99% çš„æƒ…å†µ**ï¼šä½¿ç”¨ `original_url`ï¼ˆé»˜è®¤ï¼‰
- **ç‰¹æ®Šæƒ…å†µ**ï¼šå¦‚æœåŒä¸€æ´»åŠ¨æœ‰å¤šä¸ª URLï¼Œä½¿ç”¨ `normalized_title`

### Q: å¯ä»¥æ’¤é”€åˆ é™¤å—ï¼Ÿ

**A**: ä¸å¯ä»¥ã€‚åˆ é™¤æ˜¯æ°¸ä¹…çš„ã€‚å»ºè®®ï¼š
1. å…ˆè¿è¡Œ `--dry-run` é¢„è§ˆ
2. ç¡®è®¤æ— è¯¯åå†å®é™…åˆ é™¤
3. å®šæœŸå¤‡ä»½æ•°æ®åº“

### Q: Turso å’Œæœ¬åœ°éœ€è¦åˆ†åˆ«å»é‡å—ï¼Ÿ

**A**: æ¨èæµç¨‹ï¼š
```bash
# 1. Turso å»é‡ï¼ˆä¸»åº“ï¼‰
USE_TURSO=1 npm run remove-duplicates

# 2. åŒæ­¥åˆ°æœ¬åœ°ï¼ˆè‡ªåŠ¨è·å¾—å¹²å‡€æ•°æ®ï¼‰
npm run sync-from-turso
```

æœ¬åœ°ä¸éœ€è¦å•ç‹¬å»é‡ï¼ˆé™¤éæœ¬åœ°æœ‰ç‹¬ç«‹ä¿®æ”¹ï¼‰ã€‚
